<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S4Scope ‚Äì SAP S/4HANA RFP Manager | IEZU Tech</title>
    <style>
        :root {
            --primary: #0d47a1;
            --secondary: #1a237e;
            --accent: #00c853;
            --bg: #f0f2f5;
            --card: #ffffff;
            --text: #2c3e50;
            --border: #dee2e6;
        }

        /* TEMA VE YERLE≈ûƒ∞M */
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background: var(--bg); 
            margin: 0; 
            display: flex; 
        }

        /* √úST ƒ∞LERLEME √áUBUƒûU */
        #progress-container { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 5px; 
            background: #ddd; 
            z-index: 2000; 
        }
        #progress-bar { 
            height: 100%; 
            width: 0%; 
            background: var(--accent); 
            transition: 0.4s; 
        }

        /* SOL NAVIGATOR (MEN√ú) */
        nav { 
            width: 280px; 
            background: var(--secondary); 
            color: white; 
            height: 100vh; 
            position: fixed; 
            top: 0;
            left: 0;
            padding-top: 20px; 
            box-shadow: 2px 0 10px rgba(0,0,0,0.2); 
            z-index: 1000;
            overflow-y: auto;
        }
        nav h2 { padding: 0 20px; font-size: 1.2rem; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; }
        nav ul { list-style: none; padding: 0; margin: 0; }
        nav ul li { padding: 15px 25px; cursor: pointer; transition: 0.3s; opacity: 0.7; font-size: 0.9rem; border-bottom: 1px solid rgba(255,255,255,0.05); }
        nav ul li:hover { background: rgba(255,255,255,0.05); opacity: 1; }
        nav ul li.active { opacity: 1; background: rgba(255,255,255,0.15); border-left: 5px solid var(--accent); font-weight: bold; }

        /* ANA ƒ∞√áERƒ∞K ALANI */
        main { 
            flex: 1; 
            margin-left: 280px; 
            padding: 40px; 
            width: calc(100% - 280px);
        }

        .section { background: var(--card); padding: 35px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: none; margin-bottom: 40px; }
        .section.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .section-title { border-left: 5px solid var(--primary); padding-left: 15px; margin-bottom: 25px; font-size: 1.3rem; color: var(--secondary); font-weight: 700; }
        
        /* FORM ELEMANLARI */
        input, select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; box-sizing: border-box; transition: 0.3s; }
        input:focus, select:focus { border-color: var(--primary); outline: none; }
        
        .company-block { background: #f8fbff; border: 1px solid #e3e9ef; border-radius: 10px; padding: 25px; margin-top: 20px; position: relative; }
        
        /* --- B√ñL√úM 5 √ñZEL TASARIM --- */
        .phase-card {
            border: 1px solid #e0e6ed;
            background: #ffffff;
            border-left: 6px solid var(--primary);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
            transition: 0.3s;
        }
        .phase-card:hover {
            box-shadow: 0 6px 12px rgba(0,0,0,0.05);
            transform: translateY(-2px);
        }
        .phase-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        .phase-badge {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            background: #fcfdfe;
            padding: 15px;
            border-radius: 6px;
            border: 1px dashed #ced4da;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            cursor: pointer;
            padding: 4px;
        }
        .checkbox-item input { width: auto; }

        /* BUTONLAR */
        button { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.3s; display: inline-flex; align-items: center; gap: 8px;}
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--accent); color: white; }
        .btn-danger { background: #d32f2f; color: white; }
        .btn-secondary { background: #78909c; color: white; }
        .btn-sm { padding: 5px 10px; font-size: 11px; }

        /* TABLOLAR */
        .table-container { overflow-x: auto; margin-top: 10px; border-radius: 8px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; min-width: 1000px; }
        th { background: var(--secondary); color: white; padding: 15px; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; }
        td { padding: 12px; border: 1px solid #eee; text-align: center; background: white; font-size: 0.9rem; vertical-align: middle; }

        /* SAYACLAR VE KUTULAR */
        .counter-row { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
        .counter-box { display: flex; align-items: center; gap: 10px; background: white; padding: 5px 10px; border-radius: 20px; border: 1px solid #ddd; }
        .val-span { font-weight: 700; color: var(--primary); min-width: 20px; text-align: center; }

        /* EXCEL DROPDOWN TASARIMI */
        .excel-dropdown { border: 1px solid #ced4da; padding: 6px 10px; border-radius: 6px; background: #fdfdfd; cursor: pointer; display: flex; justify-content: space-between; align-items: center; position: relative; font-size: 12px; min-width: 150px; text-align: left; transition: all 0.2s; color: #495057;}
        .excel-dropdown:hover { border-color: var(--primary); background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .excel-dropdown .label-text { font-weight: 600; color: var(--primary); background: #eef2f7; padding: 2px 8px; border-radius: 4px; white-space: nowrap; }
        .excel-menu { position: absolute; top: calc(100% + 5px); left: 0; width: 220px; background: white; border: 1px solid #bbb; box-shadow: 0 10px 25px rgba(0,0,0,0.15); z-index: 5000; display: none; max-height: 250px; overflow-y: auto; border-radius: 8px; padding: 5px 0; }
        .excel-menu label { display: flex; align-items: center; padding: 10px 15px; border-bottom: 1px solid #f1f1f1; margin: 0; font-weight: 500; cursor: pointer; gap: 12px; color: #333; transition: 0.2s; }
        .excel-menu label:hover { background: #f8f9fa; color: var(--primary); }

        /* AKORDƒ∞YON */
        .process-category { margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .process-header { background: #f8f9fa; padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: 0.3s; font-weight: 700; color: var(--secondary); border-bottom: 1px solid transparent; }
        .process-header:hover { background: #eceff1; }
        .process-header::after { content: '‚ñº'; font-size: 0.8rem; transition: 0.3s; }
        .process-category.open .process-header { border-bottom: 1px solid #e0e0e0; background: #e8eaf6; }
        .process-category.open .process-header::after { transform: rotate(180deg); }
        .process-content { display: none; padding: 20px; background: white; }
        .process-category.open .process-content { display: block; }

        .hidden { display: none !important; }
        .nav-buttons { margin-top: 30px; display: flex; justify-content: space-between; border-top: 1px solid #eee; padding-top: 20px; }

        @media print {
            nav, #progress-container, .nav-buttons, button { display: none !important; }
            main { margin-left: 0; padding: 0; width: 100%; }
            .section { box-shadow: none; border: none; display: block !important; margin: 0; padding: 0; page-break-after: always; }
            .process-content { display: block !important; }
            .excel-dropdown { border: none; padding: 0; }
        }
    </style>
</head>
<body onclick="closeAllMenus()">

    <div id="progress-container"><div id="progress-bar"></div></div>

    <nav>
        <h2>S4Scope RFP</h2>
        <ul>
            <li onclick="validateAndShowStep(0)" id="nav-0" class="active">B√∂l√ºm 0: ERP Yapƒ±sƒ±</li>
            <li onclick="validateAndShowStep(1)" id="nav-1">B√∂l√ºm 1: Genel Bilgiler</li>
            <li onclick="validateAndShowStep(2)" id="nav-2">B√∂l√ºm 2: Organizasyon & Yapƒ±</li>
            <li onclick="validateAndShowStep(3)" id="nav-3">B√∂l√ºm 3: ƒ∞≈ü S√ºre√ßleri</li>
            <li onclick="validateAndShowStep(4)" id="nav-4">B√∂l√ºm 4: Teknik & Entegrasyon</li>
            <li onclick="validateAndShowStep(5)" id="nav-5">B√∂l√ºm 5: D√∂n√º≈ü√ºm Stratejisi</li>
            <li onclick="validateAndShowStep(6)" id="nav-6">B√∂l√ºm 6: √áƒ±ktƒ± & √ñzet</li>
        </ul>
        <div style="position: absolute; bottom: 20px; left: 20px; width: 240px;">
            <button class="btn-danger" style="width: 100%; justify-content: center;" onclick="if(confirm('√áƒ±kmak istediƒüinize emin misiniz? Kaydedilmemi≈ü veriler kaybolabilir.')) location.reload();">√áƒ±kƒ±≈ü Yap</button>
        </div>
    </nav>

    <main>
        <div class="section active" id="step-0">
            <div class="section-title">B√∂l√ºm 0 - Mevcut ve Hedef ERP Yapƒ±sƒ±</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px;">
                <div><label>Mevcut ERP Sistemi</label><select id="existingErp" onchange="toggleSapFields()"><option value="">Se√ßiniz</option><option value="SAP">SAP</option><option value="Oracle">Oracle</option><option value="Logo">Logo</option><option value="Microsoft Dynamics">Microsoft Dynamics</option><option value="Diƒüer">Diƒüer</option></select></div>
                <div id="sapModelArea" class="hidden"><label>Hedef SAP Modeli</label><select id="sapModel"><option value="">Se√ßiniz</option><option>S/4HANA OnPremise</option><option>S/4HANA Public Cloud</option><option>S/4HANA Private Cloud</option><option>ECC (Legacy)</option></select></div>
                <div id="sapVersionArea" class="hidden"><label>Mevcut SAP Versiyonu</label><input type="text" id="sapVersion" placeholder="√ñrn: ECC 6.0 EHP7, 1909"></div>
                <div id="approachArea" class="hidden"><label>Ge√ßi≈ü Yakla≈üƒ±mƒ±</label><select id="sapApproach"><option value="">Se√ßiniz</option><option>Greenfield (Sƒ±fƒ±rdan Kurulum)</option><option>Brownfield (D√∂n√º≈ü√ºm)</option><option>Bluefield / Hibrit</option><option>Hen√ºz karar verilmedi</option></select></div>
            </div>
            <div class="nav-buttons" style="justify-content: flex-end;"><button class="btn-primary" onclick="validateAndShowStep(1)">Sonraki B√∂l√ºm ‚Üí</button></div>
        </div>

        <div class="section" id="step-1">
            <div class="section-title">B√∂l√ºm 1 ‚Äì ≈ûirket Bazlƒ± Genel Bilgiler</div>
            <div style="display: flex; gap: 15px; align-items: flex-end; margin-bottom: 20px; flex-wrap: wrap;">
                <div style="flex:1; min-width: 200px;"><label>RFP Kapsamƒ±ndaki ≈ûirket Sayƒ±sƒ±</label><input type="number" id="companyCount" min="1" placeholder="√ñrn: 2"></div>
                <button class="btn-primary" onclick="createCompanies()">≈ûirketleri Olu≈ütur</button>
                <button class="btn-success" onclick="addCompany()">+ Manuel ≈ûirket Ekle</button>
            </div>
            <div id="companiesContainer"></div>
            <div style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
                <button class="btn-success" onclick="saveCompanies()">≈ûirket Bilgilerini Kaydet</button>
                <button class="btn-primary hidden" id="modTabBtn" onclick="showModTable()">≈ûirket - Mod√ºl E≈üle≈üme Tablosu</button>
            </div>
            <div id="modTableContainer" class="table-container"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(0)">‚Üê Geri</button><button class="btn-primary" onclick="validateAndShowStep(2)">Sonraki B√∂l√ºm ‚Üí</button></div>
        </div>

        <div class="section" id="step-2">
            <div class="section-title">B√∂l√ºm 2 ‚Äì Organizasyon & Yapƒ±</div>
            <div id="orgContainer"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(1)">‚Üê Geri</button><button class="btn-primary" onclick="validateAndShowStep(3)">Sonraki B√∂l√ºm ‚Üí</button></div>
        </div>

        <div class="section" id="step-3">
            <div class="section-title">B√∂l√ºm 3 ‚Äì ƒ∞≈ü S√ºre√ßleri Analizi (FI + Diƒüer Mod√ºller)</div>
            <p style="color: #666; font-size: 0.9rem; margin-bottom: 20px;">A≈üaƒüƒ±daki sorular SAP S/4HANA d√∂n√º≈ü√ºm projeleri i√ßin en kritik detaylarƒ± i√ßerir.</p>
            <div id="processArea"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(2)">‚Üê Geri</button><button class="btn-primary" onclick="validateAndShowStep(4)">Sonraki B√∂l√ºm ‚Üí</button></div>
        </div>

        <div class="section" id="step-4">
            <div class="section-title">B√∂l√ºm 4 ‚Äì Teknik Entegrasyon & Yazƒ±lƒ±m Envanteri</div>
            <div id="softwareInventoryArea"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(3)">‚Üê Geri</button><button class="btn-primary" onclick="validateAndShowStep(5)">Sonraki B√∂l√ºm ‚Üí</button></div>
        </div>

        <div class="section" id="step-5">
            <div class="section-title">B√∂l√ºm 5 ‚Äì D√∂n√º≈ü√ºm Stratejisi (Fazlandƒ±rma)</div>
            <p style="color:#666; font-size:0.9rem; margin-bottom:25px;">Projenin canlƒ±ya ge√ßi≈ü (Go-Live) planƒ±nƒ± fazlar halinde kurgulayƒ±n. Her faz i√ßin kapsamdaki ≈üirketleri se√ßin.</p>
            <div style="margin-bottom:25px;"><button class="btn-success" onclick="addNewPhase()">+ Yeni Faz Ekle (Yol Haritasƒ±)</button></div>
            <div id="phasesContainer"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(4)">‚Üê Geri</button><button class="btn-primary" onclick="validateAndShowStep(6)">Son B√∂l√ºm: √áƒ±ktƒ± & √ñzet ‚Üí</button></div>
        </div>

        <div class="section" id="step-6">
            <div class="section-title">B√∂l√ºm 6 ‚Äì RFP √ñzet ve √áƒ±ktƒ± Raporu</div>
            <div id="rfpReportArea"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(5)">‚Üê Geri</button><button class="btn-success" onclick="generateFinalReport()">Raporu G√ºncelle</button><button class="btn-primary" onclick="window.print()">PDF Olarak Kaydet (Yazdƒ±r)</button></div>
        </div>
    </main>

<script>
    // --- VERƒ∞ SETLERƒ∞ ---
    const sectorMap = { "T√ºketici End√ºstrileri": ["Tarƒ±m & Gƒ±da", "FMCG", "ƒ∞la√ß", "Perakende"], "Kesikli √úretim": ["Otomotiv", "Makine √úretimi", "Y√ºksek Teknoloji", "Savunma Sanayi"], "S√ºre√ß End√ºstrileri": ["Kimya", "Petrol & Gaz", "Madencilik", "Metal"], "Enerji ve Altyapƒ±": ["Elektrik Daƒüƒ±tƒ±m", "Su/Atƒ±k", "Telekom√ºnikasyon"], "Finansal Hizmetler": ["Banka", "Sigorta", "Fintech"], "Hizmet End√ºstrileri": ["ƒ∞n≈üaat", "Lojistik", "Turizm", "Profesyonel Hizmetler"] };
    const sapModules = [ "FI - Mali Muhasebe", "FM - B√ºt√ße Kontrol", "CO - Maliyet Muhasebesi ve Karlƒ±lƒ±k", "PS - Proje Sistemi", "MM - Malzeme Y√∂netimi ve Satƒ±nalma", "SD - Satƒ±≈ü ve Daƒüƒ±tƒ±m", "PP - √úretim ve Planlama", "QM - Kalite Y√∂netimi", "PM - Bakƒ±m Y√∂netimi", "WM/EWM - Depo Y√∂netimi" ];
    const softwareGroups = { "Analitik & Finans": ["Power BI", "LucaNet", "Tableau", "Cognos"], "√úretim & Operasyon": ["Doruk OT", "ProManage", "MES Sistemleri", "SCADA"], "Satƒ±≈ü & M√º≈üteri": ["T-Soft", "Salesforce", "Magento", "Hybris"], "ƒ∞nsan Kaynaklarƒ±": ["Kolay ƒ∞K", "Logo HR", "SuccessFactors", "Workday"] };
    const fiWbsStructure = { "1. Organizasyon ve Temel Muhasebe Yapƒ±sƒ±": ["1.1 Birden fazla ≈üirket kodu?", "1.2 Mali konsolidasyon?", "1.3 Farklƒ± mali yƒ±l varyantlarƒ±?", "1.4 Birden fazla hesap planƒ±?", "1.5 Yerel/Grup muhasebe farkƒ±?"], "2. Genel Muhasebe (GL)": ["2.1 S/4HANA Universal Journal?", "2.2 Birden fazla defter?", "2.3 Belge bazlƒ± muhasebe?", "2.4 Otomatik MM/SD kayƒ±tlarƒ±?", "2.5 Manuel fi≈ü yoƒüunluƒüu?", "2.6 Onay s√ºreci?", "2.7 Zorunlu alanlar?"], "3. Alacaklar (AR)": ["3.1 A√ßƒ±k hesap takibi?", "3.2 Kredi limitleri?", "3.3 √ñdeme planlarƒ±?", "3.4 Mutabakat?", "3.5 Tahsilat takibi?", "3.6 Otomatik ihtar?", "3.7 √áoklu para birimi?"], "4. Bor√ßlar (AP)": ["4.1 Tedarik√ßi a√ßƒ±k hesap?", "4.2 Fatura onayƒ±?", "4.3 Vadeli √∂deme?", "4.4 Avans takibi?", "4.5 Tedarik√ßi mutabakatƒ±?", "4.6 Otomatik √∂deme?", "4.7 ƒ∞skonto uygulamasƒ±?"], "5. Vergi ve Yasal Raporlama": ["5.1 Otomatik KDV?", "5.2 Farklƒ± vergi kodlarƒ±?", "5.3 Yasal defter √ºretimi?", "5.4 Beyanname raporlarƒ±?", "5.5 Vergi d√ºzeltme kayƒ±tlarƒ±?"], "6. Sabit Kƒ±ymetler (FI-AA)": ["6.1 Sistem √ºzerinden takip?", "6.2 √áoklu amortisman alanƒ±?", "6.3 Vergi/Muhasebe amortisman farkƒ±?", "6.4 Alƒ±m/Satƒ±≈ü/Hurda i≈ülemleri?", "6.5 Kƒ±ymet transferleri?"], "7. Kapanƒ±≈ü ƒ∞≈ülemleri": ["7.1 Standart takvim?", "7.2 Reeskont i≈ülemleri?", "7.3 Otomatik kur farkƒ±?", "7.4 Kapanƒ±≈ü kontrolleri?", "7.5 Yetkilendirme kƒ±sƒ±tƒ±?"], "8. Raporlama ve Analiz": ["8.1 Standart mali tablolar?", "8.2 √áoklu kƒ±rƒ±lƒ±m?", "8.3 Ger√ßek zamanlƒ± rapor?", "8.4 Fiori kullanƒ±mƒ±?", "8.5 Rapor yetkilendirmesi?"], "9. Genel ve Kullanƒ±m": ["9.1 Rol bazlƒ± yetki?", "9.2 Deƒüi≈üiklik logu?", "9.3 √áoklu dil?", "9.4 √áoklu para birimi?", "9.5 Denetim izleme?"] };
    const otherModules = { "CO - Maliyet Muhasebesi ve Karlƒ±lƒ±k": ["Masraf Yeri Muhasebesi?", "√úr√ºn Maliyetlendirme?", "Karlƒ±lƒ±k Analizi?", "Parti maliyeti?", "Transfer fiyatlandƒ±rmasƒ±?"], "FM - B√ºt√ße Kontrol": ["B√ºt√ße kontrol√º (AVC)?", "Taahh√ºt y√∂netimi?", "Nakit b√ºt√ßesi?"], "MM - Malzeme Y√∂netimi ve Satƒ±nalma": ["Mobil onaylar?", "√áer√ßeve s√∂zle≈ümeler?", "Tedarik√ßi puanlama?", "MRP Live?", "Fason y√∂netim?"], "SD - Satƒ±≈ü ve Daƒüƒ±tƒ±m": ["Fiyatlandƒ±rma?", "Kredi limit kontrol√º?", "Bedelsiz y√∂netimi?", "Settlement Management?"], "PP - √úretim ve Planlama": ["MTS, MTO, ETO?", "Kapasite dengeleme?", "MES entegrasyonu?"], "QM - Kalite Y√∂netimi": ["Giri≈ü kalite?", "S√ºre√ß i√ßi?", "8D Raporlama?"], "PM - Bakƒ±m Y√∂netimi": ["Ekipman hiyerar≈üisi?", "Planlƒ± bakƒ±m?", "Mobil arƒ±za giri≈üi?"], "WM/EWM - Depo Y√∂netimi": ["Adresleme?", "RF / Fiori Barkod?", "Paketleme Spesifikasyonlarƒ±?"] };
    const allProcessStructures = { ...fiWbsStructure, ...otherModules };

    let companyIndex = 0; let savedCompanies = []; let phaseCount = 0; let rowCounter = 0; 

    // --- TEMEL FONKSƒ∞YONLAR ---
    function toggleSapFields() { const isSap = document.getElementById("existingErp").value === "SAP"; ["sapModelArea", "sapVersionArea", "approachArea"].forEach(id => document.getElementById(id).classList.toggle("hidden", !isSap)); }
    function addCompany() { companyIndex++; const div = document.createElement("div"); div.className = "company-block"; div.innerHTML = `<button class="btn-danger btn-sm" style="position:absolute; top:15px; right:15px;" onclick="this.parentElement.remove()">Sil</button><h4 style="margin:0 0 20px 0; color:var(--primary)">≈ûirket #${companyIndex}</h4><div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap:15px;"><div><label>≈ûirket Adƒ±</label><input type="text" class="comp-name" placeholder="√ñrn: ABC A.≈û."></div><div><label>√úlke</label><select><option>T√ºrkiye</option><option>Almanya</option><option>ABD</option><option>ƒ∞ngiltere</option><option>Diƒüer</option></select></div><div><label>Ana Sekt√∂r</label><select onchange="loadSubs(this)"><option value="">Se√ßiniz</option>${Object.keys(sectorMap).map(s=>`<option>${s}</option>`).join("")}</select></div><div><label>Alt Sekt√∂r</label><select class="sub-sector"><option>-</option></select></div><div><label>Faaliyet</label><select><option>√úretim</option><option>Ticaret/Hizmet</option><option>Holding</option></select></div></div>`; document.getElementById("companiesContainer").appendChild(div); }
    function createCompanies() { const count = document.getElementById("companyCount").value; if(!count || count < 1) return; document.getElementById("companiesContainer").innerHTML = ""; companyIndex = 0; for(let i=0; i<count; i++) addCompany(); }
    function loadSubs(sel) { const sub = sel.parentElement.nextElementSibling.querySelector("select"); sub.innerHTML = (sectorMap[sel.value] || []).map(s=>`<option>${s}</option>`).join(""); }
    function saveCompanies() { savedCompanies = Array.from(document.querySelectorAll(".comp-name")).map(i => i.value).filter(v => v); if(savedCompanies.length) { document.getElementById("modTabBtn").classList.remove("hidden"); renderOrg(); renderProcesses(); renderTechInventory(); alert("≈ûirketler ba≈üarƒ±yla kaydedildi."); } else { alert("L√ºtfen en az bir ≈üirket adƒ± giriniz."); } }
    function showModTable() { let html = `<table><thead><tr><th>≈ûirket Adƒ±</th>${sapModules.map(m=>`<th>${m}</th>`).join("")}</tr></thead><tbody>`; savedCompanies.forEach(name => { html += `<tr><td style="font-weight:700;">${name}</td>${sapModules.map(()=>`<td><input type="checkbox" style="width:18px; height:18px;"></td>`).join("")}</tr>`; }); document.getElementById("modTableContainer").innerHTML = html + `</tbody></table>`; }
    function renderOrg() { let html = ""; savedCompanies.forEach((name, i) => { html += `<div class="company-block"><h4>${name} - Lokasyon Bilgileri</h4>${counterRow('√úretim Tesisi', 'p'+i)}${counterRow('Depo / Lojistik Merkezi', 'w'+i)}${counterRow('Satƒ±≈ü / ƒ∞rtibat Ofisi', 's'+i)}${counterRow('Ar-Ge Merkezi', 'r'+i)}</div>`; }); document.getElementById("orgContainer").innerHTML = html; }
    function counterRow(label, id) { return `<div class="counter-row"><span>${label}</span><div class="counter-box"><button class="btn-danger btn-sm" onclick="chgVal('${id}',-1)">-</button><span class="val-span" id="${id}">0</span><button class="btn-success btn-sm" onclick="chgVal('${id}',1)">+</button></div></div>`; }
    function chgVal(id, d) { const el = document.getElementById(id); el.innerText = Math.max(0, parseInt(el.innerText) + d); }

    // --- B√ñL√úM 3: EXCEL TIPI ≈ûƒ∞RKET SE√áƒ∞Mƒ∞ ---
    function toggleExcelMenu(e, id) { e.stopPropagation(); const menu = document.getElementById(id); const isOpen = menu.style.display === 'block'; closeAllMenus(); if (!isOpen) menu.style.display = 'block'; }
    function closeAllMenus() { document.querySelectorAll('.excel-menu').forEach(m => m.style.display = 'none'); }
    function updateExcelLabel(id) { const menu = document.getElementById(id); const checkedCount = menu.querySelectorAll('input:checked').length; const labelContainer = document.getElementById('label-' + id); if (checkedCount === savedCompanies.length) labelContainer.innerText = "T√ºm ≈ûirketler"; else if (checkedCount === 0) labelContainer.innerText = "Se√ßiniz..."; else labelContainer.innerText = checkedCount + " ≈ûirket Se√ßili"; }

    function renderProcesses() {
        let html = ""; let catIndex = 0;
        for (const [title, qs] of Object.entries(allProcessStructures)) {
            catIndex++;
            html += `<div class="process-category"><div class="process-header" onclick="this.parentElement.classList.toggle('open')">${title}</div><div class="process-content"><div class="table-container"><table><thead><tr><th style="text-align:left; width:40%;">S√ºre√ß Sorusu</th><th style="width:10%;">Cevap</th><th style="width:12%;">√ñncelik</th><th style="width:20%;">≈ûirket Kapsamƒ±</th><th>Not</th><th style="width:70px;">ƒ∞≈ülem</th></tr></thead><tbody id="tbody-cat-${catIndex}">`;
            qs.forEach(q => html += generateProcessRow(q, false, false));
            html += `</tbody></table></div><div style="margin-top:15px;"><button class="btn-success btn-sm" onclick="addNewProcessRow('${catIndex}')">+ Yeni Satƒ±r Ekle</button></div></div></div>`;
        }
        document.getElementById("processArea").innerHTML = html;
    }

    function generateProcessRow(questionText, isNew = false, isDeletable = false) {
        rowCounter++; const dropId = "drop-" + rowCounter;
        return `<tr><td style="text-align:left;">${isNew ? `<input type="text" placeholder="S√ºreci tanƒ±mlayƒ±n..." style="width:95%;">` : `<span style="font-weight:600; font-size:13px;">${questionText}</span>`}</td><td><select><option value="">-</option><option>Evet</option><option>Hayƒ±r</option><option>Kƒ±smen</option></select></td><td><select style="font-weight:600; font-size:12px;"><option value="Normal">Normal</option><option value="Kritik" style="color:red; font-weight:bold;">KRƒ∞Tƒ∞K</option><option value="Y√ºksek">Y√ºksek</option><option value="D√º≈ü√ºk">D√º≈ü√ºk</option></select></td><td><div class="excel-dropdown" onclick="toggleExcelMenu(event, '${dropId}')"><span id="label-${dropId}" class="label-text">T√ºm ≈ûirketler</span> <span style="font-size:8px; opacity:0.5;">‚ñº</span><div id="${dropId}" class="excel-menu" onclick="event.stopPropagation()">${savedCompanies.map(c => `<label><input type="checkbox" checked onchange="updateExcelLabel('${dropId}')"> ${c}</label>`).join('')}</div></div></td><td><input type="text" placeholder="..." style="width:95%;"></td><td><div style="display:flex; gap:5px; justify-content:center;">${!isNew ? `<button class="btn-primary btn-sm" title="√áoƒüalt" onclick="duplicateRow(this)">‚ßâ</button>` : ''}${isDeletable ? `<button class="btn-danger btn-sm" title="Sil" onclick="this.closest('tr').remove()">‚úï</button>` : `<button class="btn-secondary btn-sm" disabled style="opacity:0.3; cursor:not-allowed;">‚úï</button>`}</div></td></tr>`;
    }

    function duplicateRow(btn) { const currentRow = btn.closest('tr'); const qText = currentRow.cells[0].innerText; const newRowHTML = generateProcessRow(qText, false, true); currentRow.insertAdjacentHTML('afterend', newRowHTML); }
    function addNewProcessRow(catId) { const tbody = document.getElementById(`tbody-cat-${catId}`); const newRowHTML = generateProcessRow("", true, true); tbody.insertAdjacentHTML('beforeend', newRowHTML); }

    function renderTechInventory() {
        let html = ""; Object.keys(softwareGroups).forEach((group, i) => {
            html += `<div class="company-block"><div style="display:flex; justify-content:space-between; align-items:center;"><h4 style="margin:0;">${group}</h4><div style="display:flex; gap:10px;"><select id="sel-soft-${i}" style="width:200px;"><option value="">Yazƒ±lƒ±m Se√ß...</option>${softwareGroups[group].map(s=>`<option value="${s}">${s}</option>`).join("")}<option value="Dƒ∞ƒûER">Diƒüer</option></select><button class="btn-success btn-sm" onclick="addSoftwareRow(${i})">Ekle</button></div></div><div class="table-container" id="cont-soft-${i}" style="display:none; margin-top:15px;"><table><thead><tr><th>Yazƒ±lƒ±m</th><th style="width:400px;">Hedef Mimari Kararƒ±</th><th>Kaldƒ±r</th></tr></thead><tbody id="tbody-soft-${i}"></tbody></table></div></div>`;
        });
        document.getElementById("softwareInventoryArea").innerHTML = html;
    }

    function addSoftwareRow(i) {
        let val = document.getElementById(`sel-soft-${i}`).value; if(!val) return; if(val === "Dƒ∞ƒûER") { val = prompt("Adƒ±:"); if(!val) return; }
        document.getElementById(`cont-soft-${i}`).style.display = "block";
        const tr = document.createElement("tr");
        tr.innerHTML = `<td style="font-weight:600;">${val}</td><td><select style="width:98%;"><option>SAP ile deƒüi≈ütirilebilir</option><option>Entegrasyon</option><option>3. Parti</option><option>Kaldƒ±rƒ±lacak</option></select></td><td><button class="btn-danger btn-sm" onclick="this.closest('tr').remove()">‚úï</button></td>`;
        document.getElementById(`tbody-soft-${i}`).appendChild(tr);
    }

    // --- B√ñL√úM 5: YENƒ∞LENEN FAZLANDIRMA TASARIMI ---
    function addNewPhase() {
        if(savedCompanies.length === 0) { alert("√ñnce B√∂l√ºm 1'de ≈üirketleri kaydedin!"); return; }
        phaseCount++;
        const div = document.createElement("div");
        div.className = "phase-card";
        div.innerHTML = `
            <div class="phase-header-row">
                <div style="display:flex; align-items:center; gap:15px;">
                    <span class="phase-badge">FAZ ${phaseCount}</span>
                    <input type="text" placeholder="Faz ƒ∞smi (√ñrn: Pilot Ge√ßi≈ü)" style="width:250px; font-weight:bold; border:none; border-bottom:1px solid #ddd; border-radius:0; padding:4px;">
                </div>
                <button class="btn-danger btn-sm" onclick="this.closest('.phase-card').remove()">Fazƒ± Sil</button>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 2fr; gap:30px;">
                <div>
                    <label style="display:block; margin-bottom:8px; font-weight:600;">üìÖ Go-Live Tarihi</label>
                    <input type="month" style="background:#f8f9fa;">
                </div>
                <div>
                    <label style="display:block; margin-bottom:8px; font-weight:600;">üè¢ Kapsamdaki ≈ûirketler</label>
                    <div class="checkbox-grid">
                        <label class="checkbox-item" style="border-bottom:1px solid #eee; width:100%; grid-column: 1 / -1; margin-bottom:5px; padding-bottom:8px;">
                            <input type="checkbox" onchange="toggleAllInPhase(this)"> <strong>T√ºm√ºn√º Se√ß</strong>
                        </label>
                        ${savedCompanies.map(c => `
                            <label class="checkbox-item">
                                <input type="checkbox" class="comp-check" value="${c}"> ${c}
                            </label>
                        `).join("")}
                    </div>
                </div>
            </div>`;
        document.getElementById("phasesContainer").appendChild(div);
    }

    function toggleAllInPhase(source) { source.closest(".checkbox-grid").querySelectorAll(".comp-check").forEach(cb => cb.checked = source.checked); }

    function generateFinalReport() {
        const companyList = savedCompanies.length > 0 ? savedCompanies.join(", ") : "Belirtilmemi≈ü";
        const erp = document.getElementById("existingErp").value || "-";
        let html = `<div class="company-block" style="background:#fff; border: 2px solid var(--primary); padding:40px;"><h1 style="text-align:center; color:var(--primary); margin-bottom:30px;">RFP KAPSAM DOK√úMANI</h1><table style="width:100%; margin-bottom:20px;"><tr><td style="font-weight:bold; width:200px; text-align:left;">Tarih:</td><td style="text-align:left;">${new Date().toLocaleDateString('tr-TR')}</td></tr><tr><td style="font-weight:bold; text-align:left;">Mevcut ERP:</td><td style="text-align:left;">${erp}</td></tr><tr><td style="font-weight:bold; text-align:left;">≈ûirketler:</td><td style="text-align:left;">${companyList}</td></tr></table></div>`;
        document.getElementById("rfpReportArea").innerHTML = html;
    }

    function validateAndShowStep(idx) { if(idx === 6) generateFinalReport(); showStep(idx); }
    function showStep(idx) { document.querySelectorAll(".section").forEach((s, i) => s.classList.toggle("active", i === idx)); document.querySelectorAll("nav ul li").forEach((l, i) => l.classList.toggle("active", i === idx)); document.getElementById("progress-bar").style.width = ((idx + 1) / 7 * 100) + "%"; window.scrollTo(0,0); }
</script>
</body>
</html>
