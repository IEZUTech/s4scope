<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S4Scope – SAP S/4HANA RFP Manager | IEZU Tech</title>
    <style>
        :root {
            --primary: #0d47a1;
            --secondary: #1a237e;
            --accent: #00c853;
            --bg: #f0f2f5;
            --card: #ffffff;
            --text: #2c3e50;
            --border: #dee2e6;
        }

        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; display: flex; color: var(--text); }

        /* PROGRESS BAR */
        #progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 5px; background: #ddd; z-index: 2000; }
        #progress-bar { height: 100%; width: 0%; background: var(--accent); transition: 0.4s; }

        /* NAVIGATOR */
        nav { width: 280px; background: var(--secondary); color: white; height: 100vh; position: fixed; padding-top: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.2); z-index: 1000; }
        nav h2 { padding: 0 20px; font-size: 1.2rem; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; }
        nav ul { list-style: none; padding: 0; }
        nav ul li { padding: 15px 25px; cursor: pointer; transition: 0.3s; opacity: 0.7; font-size: 0.9rem; }
        nav ul li.active { opacity: 1; background: rgba(255,255,255,0.1); border-left: 5px solid var(--accent); font-weight: bold; }

        /* MAIN */
        main { flex: 1; margin-left: 280px; padding: 40px; min-width: 0; }
        .section { background: var(--card); padding: 35px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: none; }
        .section.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .section-title { border-left: 5px solid var(--primary); padding-left: 15px; margin-bottom: 25px; font-size: 1.3rem; color: var(--secondary); font-weight: 700; }
        
        /* TABLES & UI ELEMENTS */
        .table-container { overflow-x: visible; margin-top: 10px; border-radius: 8px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; min-width: 1000px; }
        th { background: #f8f9fa; color: var(--secondary); padding: 12px; font-size: 0.75rem; text-transform: uppercase; border-bottom: 2px solid #eee; }
        td { padding: 10px; border: 1px solid #eee; text-align: center; background: white; font-size: 0.9rem; vertical-align: middle; }

        input, select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px; box-sizing: border-box; }
        
        .btn-primary { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .btn-success { background: var(--accent); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; }
        .btn-danger { background: #d32f2f; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; }
        .btn-sm { padding: 5px 10px; font-size: 11px; }

        /* EXCEL FILTER STYLE */
        .filter-dropdown { cursor: pointer; border: 1px solid #ccc; padding: 8px; border-radius: 4px; background: #fff; display: flex; justify-content: space-between; align-items: center; font-size: 12px; min-width: 150px; }
        .filter-menu { position: absolute; background: white; border: 1px solid #bbb; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 5000; min-width: 220px; border-radius: 6px; max-height: 250px; overflow-y: auto; text-align: left; }
        .filter-item { padding: 6px 12px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 10px; }
        .filter-item:hover { background: #f5f5f5; }
        .hidden { display: none; }

        /* ACCORDION */
        .process-category { margin-bottom: 10px; border: 1px solid #e0e0e0; border-radius: 8px; overflow: visible; }
        .process-header { background: #f8f9fa; padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 700; color: var(--secondary); }
        .process-content { display: none; padding: 15px; background: white; border-top: 1px solid #eee; }
        .process-category.open .process-content { display: block; }

        .company-block { background: #f8fbff; border: 1px solid #e3e9ef; border-radius: 10px; padding: 20px; margin-top: 20px; position: relative; }
        
        @media print { nav, #progress-container, button { display: none !important; } main { margin-left: 0; } .section { display: block !important; } }
    </style>
</head>
<body>

    <div id="progress-container"><div id="progress-bar"></div></div>

    <nav>
        <h2>S4Scope RFP</h2>
        <ul>
            <li onclick="showStep(0)" id="nav-0" class="active">Bölüm 0: ERP Yapısı</li>
            <li onclick="showStep(1)" id="nav-1">Bölüm 1: Genel Bilgiler</li>
            <li onclick="showStep(2)" id="nav-2">Bölüm 2: Organizasyon & Yapı</li>
            <li onclick="showStep(3)" id="nav-3">Bölüm 3: İş Süreçleri (FI)</li>
            <li onclick="showStep(4)" id="nav-4">Bölüm 4: Teknik & Entegrasyon</li>
            <li onclick="showStep(5)" id="nav-5">Bölüm 5: Dönüşüm Stratejisi</li>
            <li onclick="showStep(6)" id="nav-6">Bölüm 6: Çıktı & Özet</li>
        </ul>
    </nav>

    <main>
        <div class="section active" id="step-0">
            <div class="section-title">Bölüm 0 - ERP Yapısı</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div><label>Mevcut ERP</label><select id="existingErp" onchange="toggleSapFields()"><option value="">Seçiniz</option><option>SAP</option><option>Oracle</option><option>Logo</option><option>Diğer</option></select></div>
                <div id="sapModelArea" class="hidden"><label>SAP Modeli</label><select id="sapModel"><option>S/4HANA Public Cloud</option><option>S/4HANA Private Cloud</option><option>ECC</option></select></div>
                <div id="sapVersionArea" class="hidden"><label>Versiyon</label><input type="text" id="sapVersion" placeholder="Örn: 2022"></div>
            </div>
            <div style="margin-top:40px; text-align:right;"><button class="btn-primary" onclick="showStep(1)">Sonraki →</button></div>
        </div>

        <div class="section" id="step-1">
            <div class="section-title">Bölüm 1 – Şirket Bilgileri</div>
            <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                <input type="number" id="companyCount" style="width:150px;" placeholder="Şirket Sayısı">
                <button class="btn-primary" onclick="createCompanies()">Şirketleri Oluştur</button>
            </div>
            <div id="companiesContainer"></div>
            <div style="margin-top:20px;">
                <button class="btn-success" onclick="saveCompanies()">Şirketleri Kaydet ve Devam Et</button>
            </div>
            <div id="modTableContainer" class="table-container" style="margin-top:20px;"></div>
            <div style="margin-top:40px; display:flex; justify-content:space-between;">
                <button class="btn-primary" style="background:#777" onclick="showStep(0)">← Geri</button>
                <button class="btn-primary" onclick="showStep(2)">Sonraki →</button>
            </div>
        </div>

        <div class="section" id="step-2">
            <div class="section-title">Bölüm 2 – Organizasyon Yapısı</div>
            <div id="orgContainer"></div>
            <div style="margin-top:40px; display:flex; justify-content:space-between;">
                <button class="btn-primary" style="background:#777" onclick="showStep(1)">← Geri</button>
                <button class="btn-primary" onclick="showStep(3)">Sonraki →</button>
            </div>
        </div>

        <div class="section" id="step-3">
            <div class="section-title">Bölüm 3 – İş Süreçleri Analizi (FI)</div>
            <div id="processArea"></div>
            <div style="margin-top:40px; display:flex; justify-content:space-between;">
                <button class="btn-primary" style="background:#777" onclick="showStep(2)">← Geri</button>
                <button class="btn-primary" onclick="showStep(4)">Sonraki →</button>
            </div>
        </div>

        <div class="section" id="step-4">
            <div class="section-title">Bölüm 4 – Teknik Entegrasyon & Envanter</div>
            <div id="softwareInventoryArea"></div>
            <div style="margin-top:40px; display:flex; justify-content:space-between;">
                <button class="btn-primary" style="background:#777" onclick="showStep(3)">← Geri</button>
                <button class="btn-primary" onclick="showStep(5)">Sonraki →</button>
            </div>
        </div>

        <div class="section" id="step-5">
            <div class="section-title">Bölüm 5 – Dönüşüm Stratejisi</div>
            <button class="btn-success" onclick="addNewPhase()">+ Yeni Faz Ekle</button>
            <div id="phasesContainer"></div>
            <div style="margin-top:40px; display:flex; justify-content:space-between;">
                <button class="btn-primary" style="background:#777" onclick="showStep(4)">← Geri</button>
                <button class="btn-primary" onclick="showStep(6)">Özeti Gör →</button>
            </div>
        </div>

        <div class="section" id="step-6">
            <div class="section-title">Bölüm 6 – RFP Özet Raporu</div>
            <div id="finalSummary" class="company-block">Rapor oluşturuluyor...</div>
            <button class="btn-primary" onclick="window.print()">PDF Olarak Yazdır</button>
        </div>
    </main>

<script>
    let savedCompanies = [];
    const fiWbs = {
        "Genel Muhasebe": ["Defter Yapısı", "Belge Onay Süreçleri", "Dönem Sonu Kapanış"],
        "Borçlar/Alacaklar": ["E-Fatura Entegrasyonu", "Ödeme Planları", "Mutabakat Süreçleri"]
    };
    const softwareGroups = ["Finans & ERP", "Lojistik & Depo", "İK & Bordro", "CRM & Satış"];

    function toggleSapFields() {
        const isSap = document.getElementById("existingErp").value === "SAP";
        document.getElementById("sapModelArea").classList.toggle("hidden", !isSap);
        document.getElementById("sapVersionArea").classList.toggle("hidden", !isSap);
    }

    function createCompanies() {
        const count = document.getElementById("companyCount").value;
        const container = document.getElementById("companiesContainer");
        container.innerHTML = "";
        for(let i=1; i<=count; i++) {
            container.innerHTML += `<div class="company-block"><h4>Şirket #${i}</h4><input type="text" class="comp-name" placeholder="Şirket Adını Giriniz"></div>`;
        }
    }

    function saveCompanies() {
        savedCompanies = Array.from(document.querySelectorAll(".comp-name")).map(i => i.value).filter(v => v);
        if(savedCompanies.length === 0) { alert("Lütfen şirket adı girin"); return; }
        renderOrg();
        renderProcesses();
        renderTechInventory();
        alert("Şirketler ve süreç tabloları güncellendi.");
    }

    function renderOrg() {
        let h = "";
        savedCompanies.forEach(c => h += `<div class="company-block"><h4>${c}</h4><label>Tesis Sayısı</label><input type="number" value="1"></div>`);
        document.getElementById("orgContainer").innerHTML = h;
    }

    // --- BÖLÜM 3: EXCEL TİPİ FİLTRELEME ---
    function renderProcesses() {
        let h = "";
        let idx = 0;
        for (const [cat, qs] of Object.entries(fiWbs)) {
            idx++;
            h += `<div class="process-category">
                <div class="process-header" onclick="this.parentElement.classList.toggle('open')">${cat}</div>
                <div class="process-content">
                    <table>
                        <thead><tr><th style="text-align:left;">Süreç</th><th style="width:120px;">Cevap</th><th style="width:200px;">Şirket Kapsamı</th><th>İşlem</th></tr></thead>
                        <tbody>${qs.map(q => generateProcessRow(q)).join("")}</tbody>
                    </table>
                </div>
            </div>`;
        }
        document.getElementById("processArea").innerHTML = h;
    }

    function generateProcessRow(question) {
        const filterId = 'filter-' + Math.random().toString(36).substr(2, 9);
        const companyList = savedCompanies.map(c => `
            <div class="filter-item">
                <input type="checkbox" checked value="${c}" onchange="updateFilterText('${filterId}')">
                <span>${c}</span>
            </div>
        `).join("");

        return `<tr>
            <td style="text-align:left; font-weight:600;">${question}</td>
            <td><select><option>Evet</option><option>Hayır</option></select></td>
            <td style="position:relative;">
                <div class="filter-dropdown" onclick="toggleFilter(event, '${filterId}')">
                    <span id="text-${filterId}">Tüm Şirketler</span>
                    <span>▼</span>
                </div>
                <div id="${filterId}" class="filter-menu hidden">
                    <div style="padding:8px; border-bottom:1px solid #ddd; background:#eee;">
                        <button class="btn-sm btn-primary" onclick="bulkFilter('${filterId}', true)">Tümü</button>
                        <button class="btn-sm btn-danger" onclick="bulkFilter('${filterId}', false)">Hiçbiri</button>
                    </div>
                    ${companyList}
                </div>
            </td>
            <td><button class="btn-danger btn-sm" onclick="this.closest('tr').remove()">✕</button></td>
        </tr>`;
    }

    function toggleFilter(e, id) {
        e.stopPropagation();
        const menu = document.getElementById(id);
        document.querySelectorAll('.filter-menu').forEach(m => { if(m.id !== id) m.classList.add('hidden'); });
        menu.classList.toggle('hidden');
    }

    function updateFilterText(id) {
        const menu = document.getElementById(id);
        const checked = menu.querySelectorAll('input:checked').length;
        const total = menu.querySelectorAll('input[type="checkbox"]').length;
        const label = document.getElementById('text-' + id);
        label.innerText = (checked === total) ? "Tüm Şirketler" : (checked === 0 ? "Seçim Yok" : checked + " Şirket");
    }

    function bulkFilter(id, state) {
        const menu = document.getElementById(id);
        menu.querySelectorAll('input').forEach(i => i.checked = state);
        updateFilterText(id);
    }

    // --- BÖLÜM 4: STRATEJİK SEÇENEKLER ---
    function renderTechInventory() {
        let h = "";
        softwareGroups.forEach((g, i) => {
            h += `<div class="company-block">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h4>${g}</h4>
                    <button class="btn-success btn-sm" onclick="addSoftware('${i}')">+ Ekle</button>
                </div>
                <table style="margin-top:10px;"><thead><tr><th>Yazılım</th><th>Stratejik Karar</th><th>İşlem</th></tr></thead><tbody id="soft-body-${i}"></tbody></table>
            </div>`;
        });
        document.getElementById("softwareInventoryArea").innerHTML = h;
    }

    function addSoftware(idx) {
        const name = prompt("Yazılım Adı:");
        if(!name) return;
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td style="text-align:left; font-weight:bold;">${name}</td>
            <td>
                <select>
                    <option>SAP Ürün/Modül/Addon ile değiştirilebilir</option>
                    <option>Hedef Mimaride kullanıma devam edilecek</option>
                    <option>3. Parti Sistem/Yazılım ile değiştirilebilir</option>
                </select>
            </td>
            <td><button class="btn-danger btn-sm" onclick="this.closest('tr').remove()">✕</button></td>`;
        document.getElementById("soft-body-" + idx).appendChild(tr);
    }

    function showStep(idx) {
        document.querySelectorAll(".section").forEach((s, i) => s.classList.toggle("active", i === idx));
        document.querySelectorAll("nav ul li").forEach((l, i) => l.classList.toggle("active", i === idx));
        document.getElementById("progress-bar").style.width = (idx / 6 * 100) + "%";
        if(idx === 6) document.getElementById("finalSummary").innerText = savedCompanies.length + " Şirket için RFP Hazırlandı.";
    }

    window.onclick = () => document.querySelectorAll('.filter-menu').forEach(m => m.classList.add('hidden'));
</script>
</body>
</html>
