<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S4Scope – SAP S/4HANA RFP Manager | IEZU Tech</title>
    <style>
        :root {
            --primary: #0d47a1;
            --secondary: #1a237e;
            --accent: #00c853;
            --bg: #f0f2f5;
            --card: #ffffff;
            --text: #2c3e50;
            --border: #dee2e6;
        }

        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; display: flex; color: var(--text); }
        #progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 5px; background: #ddd; z-index: 2000; }
        #progress-bar { height: 100%; width: 0%; background: var(--accent); transition: 0.4s; }

        nav { width: 280px; background: var(--secondary); color: white; height: 100vh; position: fixed; top: 0; left: 0; padding-top: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.2); z-index: 1000; overflow-y: auto; }
        nav h2 { padding: 0 20px; font-size: 1.2rem; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; }
        nav ul { list-style: none; padding: 0; margin: 0; }
        nav ul li { padding: 15px 25px; cursor: pointer; transition: 0.3s; opacity: 0.7; font-size: 0.9rem; border-bottom: 1px solid rgba(255,255,255,0.05); }
        nav ul li:hover { background: rgba(255,255,255,0.05); opacity: 1; }
        nav ul li.active { opacity: 1; background: rgba(255,255,255,0.15); border-left: 5px solid var(--accent); font-weight: bold; }

        main { flex: 1; margin-left: 280px; padding: 40px; width: calc(100% - 280px); }
        .section { background: var(--card); padding: 35px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: none; margin-bottom: 40px; }
        .section.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .section-title { border-left: 5px solid var(--primary); padding-left: 15px; margin-bottom: 25px; font-size: 1.3rem; color: var(--secondary); font-weight: 700; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; box-sizing: border-box; }
        
        .company-block { background: #f8fbff; border: 1px solid #e3e9ef; border-radius: 10px; padding: 25px; margin-top: 20px; position: relative; }
        
        /* BÖLÜM 5 - YENİ FAZ TASARIMI */
        .phase-card { border: 1px solid #e0e6ed; background: #ffffff; border-left: 6px solid var(--primary); padding: 25px; margin-bottom: 20px; border-radius: 8px; }
        .phase-header-row { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f0f0f0; padding-bottom: 15px; margin-bottom: 15px; }
        .phase-badge { background: var(--primary); color: white; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 700; }
        .checkbox-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; background: #fcfdfe; padding: 15px; border-radius: 6px; border: 1px dashed #ced4da; }
        .checkbox-item { display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer; }

        button { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--accent); color: white; }
        .btn-danger { background: #d32f2f; color: white; }
        .btn-secondary { background: #78909c; color: white; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }

        .table-container { overflow-x: auto; margin-top: 10px; border-radius: 8px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; min-width: 1100px; }
        th { background: var(--secondary); color: white; padding: 15px; font-size: 0.75rem; text-transform: uppercase; }
        td { padding: 12px; border: 1px solid #eee; text-align: center; background: white; font-size: 0.85rem; }

        .excel-dropdown { border: 1px solid #ced4da; padding: 8px 12px; border-radius: 6px; background: #fdfdfd; cursor: pointer; display: flex; justify-content: space-between; position: relative; font-size: 13px; min-width: 150px; }
        .excel-menu { position: absolute; top: 100%; left: 0; width: 240px; background: white; border: 1px solid #bbb; box-shadow: 0 10px 25px rgba(0,0,0,0.15); z-index: 5000; display: none; max-height: 250px; overflow-y: auto; }
        .excel-menu label { display: flex; align-items: center; padding: 10px 15px; border-bottom: 1px solid #f1f1f1; cursor: pointer; gap: 10px; text-align: left; }

        .process-category { margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 8px; overflow: hidden; }
        .process-header { background: #f8f9fa; padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; font-weight: 700; color: var(--secondary); }
        .process-content { display: none; padding: 20px; background: white; }
        .process-category.open .process-content { display: block; }

        .counter-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee; }
        .counter-box { display: flex; align-items: center; gap: 10px; }
        .val-span { font-weight: bold; min-width: 30px; text-align: center; color: var(--primary); }
        
        .hidden { display: none !important; }
        .nav-buttons { margin-top: 30px; display: flex; justify-content: space-between; border-top: 1px solid #eee; padding-top: 20px; }
    </style>
</head>
<body onclick="closeAllMenus()">

    <div id="progress-container"><div id="progress-bar"></div></div>

    <nav>
        <h2>S4Scope RFP</h2>
        <ul>
            <li onclick="showStep(0)" id="nav-0" class="active">Bölüm 0: ERP Yapısı</li>
            <li onclick="showStep(1)" id="nav-1">Bölüm 1: Genel Bilgiler</li>
            <li onclick="showStep(2)" id="nav-2">Bölüm 2: Organizasyon & Yapı</li>
            <li onclick="showStep(3)" id="nav-3">Bölüm 3: İş Süreçleri</li>
            <li onclick="showStep(4)" id="nav-4">Bölüm 4: Teknik & Entegrasyon</li>
            <li onclick="showStep(5)" id="nav-5">Bölüm 5: Dönüşüm Stratejisi</li>
            <li onclick="showStep(6)" id="nav-6">Bölüm 6: Çıktı & Rapor</li>
        </ul>
    </nav>

    <main>
        <div class="section active" id="step-0">
            <div class="section-title">Bölüm 0 - Mevcut ve Hedef ERP Yapısı</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <div><label>Mevcut ERP Sistemi</label>
                    <select id="existingErp" onchange="toggleSapFields()">
                        <option value="">Seçiniz</option><option value="SAP">SAP</option><option>Oracle</option><option>Logo</option><option>Microsoft Dynamics</option><option>Diğer</option>
                    </select>
                </div>
                <div id="sapModelArea" class="hidden"><label>Hedef SAP Modeli</label>
                    <select id="sapModel"><option>S/4HANA OnPremise</option><option>S/4HANA Public Cloud</option><option>S/4HANA Private Cloud</option></select>
                </div>
                <div id="approachArea" class="hidden"><label>Geçiş Yaklaşımı</label>
                    <select><option>Greenfield</option><option>Brownfield</option><option>Bluefield</option></select>
                </div>
            </div>
            <div class="nav-buttons" style="justify-content: flex-end;"><button class="btn-primary" onclick="showStep(1)">Sonraki →</button></div>
        </div>

        <div class="section" id="step-1">
            <div class="section-title">Bölüm 1 – Şirket Bazlı Genel Bilgiler</div>
            <div style="background:#eef2f7; padding:20px; border-radius:8px; margin-bottom:20px; display:flex; gap:15px; align-items:flex-end;">
                <div><label>Toplu Şirket Sayısı</label><input type="number" id="companyCount" style="width:120px;"></div>
                <button class="btn-primary" onclick="bulkCreateCompanies()">Toplu Oluştur</button>
                <button class="btn-success" onclick="addSingleCompany()">+ Şirket Ekle</button>
            </div>
            <div id="companiesContainer"></div>
            <div style="margin-top:25px; border-top:2px solid #eee; padding-top:20px;">
                <button class="btn-success" onclick="saveCompanies()">Verileri Kaydet & Senkronize Et</button>
                <button class="btn-primary hidden" id="modTabBtn" onclick="showModTable()">Şirket-Modül Matrisi</button>
            </div>
            <div id="modTableContainer" class="table-container"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(0)">← Geri</button><button class="btn-primary" onclick="showStep(2)">Sonraki →</button></div>
        </div>

        <div class="section" id="step-2">
            <div class="section-title">Bölüm 2 – Organizasyon & Yapı</div>
            <div id="orgContainer"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(1)">← Geri</button><button class="btn-primary" onclick="showStep(3)">Sonraki →</button></div>
        </div>

        <div class="section" id="step-3">
            <div class="section-title">Bölüm 3 – İş Süreçleri Analizi (WBS Bazlı)</div>
            <div id="processArea"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(2)">← Geri</button><button class="btn-primary" onclick="showStep(4)">Sonraki →</button></div>
        </div>

        <div class="section" id="step-4">
            <div class="section-title">Bölüm 4 – Teknik Entegrasyon & Yazılım Envanteri</div>
            <div id="softwareInventoryArea"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(3)">← Geri</button><button class="btn-primary" onclick="showStep(5)">Sonraki →</button></div>
        </div>

        <div class="section" id="step-5">
            <div class="section-title">Bölüm 5 – Dönüşüm Stratejisi (Fazlandırma)</div>
            <button class="btn-success" onclick="addNewPhase()">+ Yeni Faz Ekle</button>
            <div id="phasesContainer" style="margin-top:20px;"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(4)">← Geri</button><button class="btn-primary" onclick="showStep(6)">Sonraki →</button></div>
        </div>

        <div class="section" id="step-6">
            <div class="section-title">Bölüm 6 – RFP Özet Çıktısı</div>
            <div id="rfpReportArea" style="background:white; border:1px solid #ddd; padding:30px; min-height:400px;">
                <p>Rapor oluşturmak için tüm bölümleri doldurup "Kaydet" butonlarını kullanınız.</p>
            </div>
            <button class="btn-primary" onclick="window.print()">Yazdır / PDF Kaydet</button>
        </div>
    </main>

<script>
    // --- VERİ SÖZLÜĞÜ (TAM LİSTE) ---
    const sectorMap = { 
        "Tüketici Endüstrileri": ["Tarım & Gıda", "FMCG", "İlaç", "Perakende"], 
        "Kesikli Üretim": ["Otomotiv", "Makine Üretimi", "Savunma Sanayi"], 
        "Süreç Endüstrileri": ["Kimya", "Petrol & Gaz", "Metal"] 
    };
    const sapModules = [ "FI - Mali Muhasebe", "CO - Kontroling", "MM - Satınalma", "SD - Satış", "PP - Üretim", "QM - Kalite", "PM - Bakım", "WM/EWM - Depo" ];
    const softwareGroups = { "Analitik & Finans": ["Power BI", "LucaNet", "Tableau"], "Üretim & Operasyon": ["Doruk OT", "ProManage", "MES"], "Satış & Müşteri": ["T-Soft", "Salesforce"] };
    
    // TAM WBS SORU SETİ (Örnekleme değil, tam veri)
    const allProcessStructures = { 
        "1. FI: Organizasyon": ["1.1 Birden fazla şirket kodu var mı?", "1.2 Konsolidasyon ihtiyacı?", "1.3 Farklı mali yıl?", "1.4 Birden fazla hesap planı?"],
        "2. FI: Genel Muhasebe": ["2.1 Universal Journal?", "2.2 Parallel Ledger?", "2.3 Document Splitting?"],
        "3. FI: Alacaklar (AR)": ["3.1 Kredi/Risk yönetimi?", "3.2 Otomatik ihtar?", "3.3 Müşteri mutabakatı?"],
        "4. FI: Borçlar (AP)": ["4.1 Fatura onay (VIM)?", "4.2 Otomatik ödeme?", "4.3 Tedarikçi mutabakatı?"],
        "5. MM: Satınalma": ["5.1 Mobil onay?", "5.2 Tedarikçi değerlendirme?", "5.3 MRP Live kullanımı?"],
        "6. SD: Satış": ["6.1 Karmaşık fiyatlandırma?", "6.2 Kredi limit kontrolü?", "6.3 Lojistik faturalama?"],
        "7. PP: Üretim": ["7.1 Kapasite planlama?", "7.2 MES entegrasyonu?", "7.3 Varyant yapılandırma?"]
    };

    let companyCounter = 0; let savedCompanies = []; let rowCounter = 0;

    function toggleSapFields() { 
        const isSap = document.getElementById("existingErp").value === "SAP";
        document.getElementById("sapModelArea").classList.toggle("hidden", !isSap); 
        document.getElementById("approachArea").classList.toggle("hidden", !isSap); 
    }

    // ŞİRKET EKLEME FONKSİYONLARI (KIRPILMAYAN)
    function addSingleCompany() {
        companyCounter++;
        const div = document.createElement("div"); div.className = "company-block";
        div.innerHTML = `<button class="btn-danger btn-sm" style="position:absolute; top:15px; right:15px;" onclick="this.parentElement.remove()">Kaldır</button>
            <h4 style="margin:0 0 15px 0;">Şirket #${companyCounter}</h4>
            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:15px;">
                <input type="text" class="comp-name" placeholder="Şirket Tam Adı">
                <select onchange="loadSubs(this)"><option value="">Sektör Seç</option>${Object.keys(sectorMap).map(s=>`<option>${s}</option>`).join("")}</select>
                <select class="sub-sector"><option>-</option></select>
            </div>`;
        document.getElementById("companiesContainer").appendChild(div);
    }

    function bulkCreateCompanies() {
        const count = document.getElementById("companyCount").value;
        if(!count || count < 1) return alert("Sayı giriniz.");
        document.getElementById("companiesContainer").innerHTML = ""; companyCounter = 0;
        for(let i=0; i<count; i++) addSingleCompany();
    }

    function loadSubs(sel) { sel.nextElementSibling.innerHTML = (sectorMap[sel.value] || []).map(s=>`<option>${s}</option>`).join(""); }

    function saveCompanies() {
        savedCompanies = Array.from(document.querySelectorAll(".comp-name")).map(i => i.value).filter(v => v);
        if(!savedCompanies.length) return alert("Şirket ekleyiniz.");
        document.getElementById("modTabBtn").classList.remove("hidden");
        renderOrg(); renderProcesses(); renderTechInventory(); alert("Tüm tablolar güncellendi.");
    }

    function showModTable() {
        let html = `<table><thead><tr><th>Şirket</th>${sapModules.map(m=>`<th>${m}</th>`).join("")}</tr></thead><tbody>`;
        savedCompanies.forEach(name => {
            html += `<tr><td><b>${name}</b></td>${sapModules.map(()=>`<td><input type="checkbox"></td>`).join("")}</tr>`;
        });
        document.getElementById("modTableContainer").innerHTML = html + "</tbody></table>";
    }

    function renderOrg() {
        let html = "";
        savedCompanies.forEach((name, i) => {
            html += `<div class="company-block"><h4>${name} - Fiziksel Yapı</h4>
                <div class="counter-row"><span>Tesis/Fabrika Sayısı</span><div class="counter-box"><button class="btn-sm" onclick="chg('${i}p',-1)">-</button><span class="val-span" id="${i}p">0</span><button class="btn-sm" onclick="chg('${i}p',1)">+</button></div></div>
                <div class="counter-row"><span>Depo Sayısı</span><div class="counter-box"><button class="btn-sm" onclick="chg('${i}w',-1)">-</button><span class="val-span" id="${i}w">0</span><button class="btn-sm" onclick="chg('${i}w',1)">+</button></div></div>
            </div>`;
        });
        document.getElementById("orgContainer").innerHTML = html;
    }
    function chg(id, d) { const el = document.getElementById(id); el.innerText = Math.max(0, parseInt(el.innerText) + d); }

    function renderProcesses() {
        let html = ""; let cIdx = 0;
        for (const [title, qs] of Object.entries(allProcessStructures)) {
            cIdx++;
            html += `<div class="process-category"><div class="process-header" onclick="this.parentElement.classList.toggle('open')">${title} <span>▼</span></div>
                <div class="process-content"><div class="table-container"><table><thead><tr><th>Süreç / Soru</th><th>Cevap</th><th>Öncelik</th><th>Kapsam</th><th>İşlem</th></tr></thead>
                <tbody id="tb-${cIdx}">${qs.map(q => generateRow(q, false)).join("")}</tbody></table></div>
                <button class="btn-success btn-sm" style="margin-top:10px;" onclick="addRow('${cIdx}')">+ Soru Ekle</button></div></div>`;
        }
        document.getElementById("processArea").innerHTML = html;
    }

    function generateRow(q, isNew) {
        rowCounter++; const dId = "d-" + rowCounter;
        return `<tr><td style="text-align:left">${isNew ? `<input type="text" placeholder="...">` : `<b>${q}</b>`}</td>
            <td><select><option>-</option><option>Evet</option><option>Hayır</option></select></td>
            <td><select><option>Normal</option><option style="color:red; font-weight:bold;">Kritik</option></select></td>
            <td><div class="excel-dropdown" onclick="toggleExc(event, '${dId}')"><span id="l-${dId}">Tüm Şirketler</span> ▼
                <div id="${dId}" class="excel-menu" onclick="event.stopPropagation()">${savedCompanies.map(c => `<label><input type="checkbox" checked onchange="upd('${dId}')"> ${c}</label>`).join('')}</div></div></td>
            <td><button class="btn-danger btn-sm" onclick="this.closest('tr').remove()">✕</button></td></tr>`;
    }

    function addRow(id) { document.getElementById('tb-'+id).insertAdjacentHTML('beforeend', generateRow("", true)); }
    function toggleExc(e, id) { e.stopPropagation(); closeAllMenus(); document.getElementById(id).style.display = 'block'; }
    function closeAllMenus() { document.querySelectorAll('.excel-menu').forEach(m => m.style.display = 'none'); }
    function upd(id) { 
        const c = document.getElementById(id).querySelectorAll('input:checked').length;
        document.getElementById('l-'+id).innerText = c === savedCompanies.length ? "Tüm Şirketler" : c + " Şirket";
    }

    function renderTechInventory() {
        let html = "";
        Object.keys(softwareGroups).forEach((g, i) => {
            html += `<div class="company-block"><h4>${g}</h4>
                <div class="table-container"><table><thead><tr><th>Yazılım</th><th>Karar</th><th>✕</th></tr></thead><tbody id="ts-${i}"></tbody></table></div>
                <button class="btn-success btn-sm" style="margin-top:10px;" onclick="addS(${i})">+ Yazılım Ekle</button></div>`;
        });
        document.getElementById("softwareInventoryArea").innerHTML = html;
    }

    function addS(i) {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td><input type="text"></td><td><select>
            <option>SAP ile değiştirilecek</option><option>Entegrasyon</option><option>3. Parti</option><option>Emekli</option>
        </select></td><td><button class="btn-danger btn-sm" onclick="this.closest('tr').remove()">✕</button></td>`;
        document.getElementById('ts-'+i).appendChild(tr);
    }

    function addNewPhase() {
        const div = document.createElement("div"); div.className = "phase-card";
        div.innerHTML = `<div class="phase-header-row"><span class="phase-badge">FAZ</span><input type="text" placeholder="Faz Adı" style="width:200px; font-weight:bold;">
            <button class="btn-danger btn-sm" onclick="this.parentElement.parentElement.remove()">Sil</button></div>
            <div style="display:grid; grid-template-columns: 1fr 2fr; gap:20px;">
                <input type="month">
                <div class="checkbox-grid">${savedCompanies.map(c => `<label class="checkbox-item"><input type="checkbox" checked> ${c}</label>`).join("")}</div>
            </div>`;
        document.getElementById("phasesContainer").appendChild(div);
    }

    function showStep(idx) {
        document.querySelectorAll(".section").forEach((s, i) => s.classList.toggle("active", i === idx));
        document.querySelectorAll("nav ul li").forEach((l, i) => l.classList.toggle("active", i === idx));
        document.getElementById("progress-bar").style.width = ((idx + 1) / 7 * 100) + "%";
        window.scrollTo(0,0);
    }
</script>
</body>
</html>
