<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S4Scope ‚Äì SAP S/4HANA RFP Manager | IEZU Tech</title>
    <style>
        :root {
            --primary: #0d47a1;
            --secondary: #1a237e;
            --accent: #00c853;
            --bg: #f0f2f5;
            --card: #ffffff;
            --text: #2c3e50;
            --border: #dee2e6;
        }

        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; display: flex; }

        /* PROGRESS BAR */
        #progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 5px; background: #ddd; z-index: 2000; }
        #progress-bar { height: 100%; width: 0%; background: var(--accent); transition: 0.4s; }

        /* NAVIGATOR */
        nav { width: 280px; background: var(--secondary); color: white; height: 100vh; position: fixed; padding-top: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.2); }
        nav h2 { padding: 0 20px; font-size: 1.2rem; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; }
        nav ul { list-style: none; padding: 0; }
        nav ul li { padding: 15px 25px; cursor: pointer; transition: 0.3s; opacity: 0.7; font-size: 0.9rem; }
        nav ul li.active { opacity: 1; background: rgba(255,255,255,0.1); border-left: 5px solid var(--accent); font-weight: bold; }

        /* MAIN */
        main { flex: 1; margin-left: 280px; padding: 40px; }
        .section { background: var(--card); padding: 35px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: none; }
        .section.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .section-title { border-left: 5px solid var(--primary); padding-left: 15px; margin-bottom: 25px; font-size: 1.3rem; color: var(--secondary); font-weight: 700; }
        
        /* G√úNCELLENEN GRID YAPISI - 5 KOLON YAN YANA */
        .grid-setup { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; text-align: left;}
        
        label { font-weight: 600; font-size: 0.85rem; color: #546e7a; display: block; margin-bottom: 8px; }
        input, select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 13px; }
        
        .company-block { background: #f8fbff; border: 1px solid #e3e9ef; border-radius: 10px; padding: 25px; margin-top: 20px; position: relative; }
        
        .counter-row { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
        .counter-box { display: flex; align-items: center; gap: 10px; background: white; padding: 5px 10px; border-radius: 20px; border: 1px solid #ddd; }
        .val-span { font-weight: 700; color: var(--primary); min-width: 20px; text-align: center; }

        button { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.3s; display: inline-flex; align-items: center; gap: 8px;}
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--accent); color: white; }
        .btn-danger { background: #d32f2f; color: white; }
        .btn-secondary { background: #78909c; color: white; }

        .table-container { overflow-x: auto; margin-top: 20px; border-radius: 8px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; min-width: 1000px; }
        th { background: var(--secondary); color: white; padding: 15px; font-size: 0.75rem; text-transform: uppercase; }
        td { padding: 12px; border: 1px solid #eee; text-align: center; background: white; font-size: 0.9rem;}

        .hidden { display: none; }

        .nav-buttons {
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        .phase-card { border: 2px dashed #ccc; padding: 20px; margin-top: 20px; border-radius: 10px; background: #fff; }
        .phase-badge { background: var(--secondary); color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.8rem; margin: 5px; display: inline-block; }

        @media print {
            nav, #progress-container, .nav-buttons, button { display: none !important; }
            main { margin-left: 0; padding: 0; }
            .section { box-shadow: none; border: none; display: block !important; }
        }
    </style>
</head>
<body>

    <div id="progress-container"><div id="progress-bar"></div></div>

    <nav>
        <h2>S4Scope RFP</h2>
        <ul>
            <li onclick="validateAndShowStep(0)" id="nav-0" class="active">B√∂l√ºm 0: ERP Yapƒ±sƒ±</li>
            <li onclick="validateAndShowStep(1)" id="nav-1">B√∂l√ºm 1: Genel Bilgiler</li>
            <li onclick="validateAndShowStep(2)" id="nav-2">B√∂l√ºm 2: Organizasyon & Yapƒ±</li>
            <li onclick="validateAndShowStep(3)" id="nav-3">B√∂l√ºm 3: ƒ∞≈ü S√ºre√ßleri</li>
            <li onclick="validateAndShowStep(4)" id="nav-4">B√∂l√ºm 4: Teknik & Entegrasyon</li>
            <li onclick="validateAndShowStep(5)" id="nav-5">B√∂l√ºm 5: D√∂n√º≈ü√ºm Stratejisi</li>
            <li onclick="validateAndShowStep(6)" id="nav-6">B√∂l√ºm 6: √áƒ±ktƒ± & √ñzet</li>
        </ul>
    </nav>

    <main>
        <div class="section active" id="step-0">
            <div class="section-title">B√∂l√ºm 0 - ERP Yapƒ±sƒ±</div>
            <div class="grid-setup">
                <div>
                    <label>Mevcut ERP Sistemi</label>
                    <select id="existingErp" onchange="toggleSapFields()">
                        <option value="">Se√ßiniz</option>
                        <option value="SAP">SAP</option>
                        <option value="Oracle">Oracle</option>
                        <option value="Logo">Logo</option>
                        <option value="Diƒüer">Diƒüer</option>
                    </select>
                </div>
                <div id="sapModelArea" class="hidden">
                    <label>SAP Modeli</label>
                    <select id="sapModel">
                        <option value="">Se√ßiniz</option>
                        <option>S/4HANA OnPremise</option>
                        <option>S/4HANA Public Cloud</option>
                        <option>S/4HANA Private Cloud</option>
                        <option>ECC</option>
                        <option>R/3</option>
                    </select>
                </div>
                <div id="sapVersionArea" class="hidden">
                    <label>SAP Versiyonu</label>
                    <input type="text" id="sapVersion" placeholder="√ñrn: 1909, 2022 FPS02">
                </div>
                <div id="approachArea" class="hidden">
                    <label>Ge√ßi≈ü Yakla≈üƒ±mƒ±</label>
                    <select id="sapApproach">
                        <option value="">Se√ßiniz</option>
                        <option>Greenfield</option>
                        <option>Brownfield</option>
                        <option>Bluefield / Hibrit</option>
                        <option>Hen√ºz karar verilmedi</option>
                    </select>
                </div>
            </div>
            <div class="nav-buttons" style="justify-content: flex-end;">
                <button class="btn-primary" onclick="validateAndShowStep(1)">Sonraki B√∂l√ºm ‚Üí</button>
            </div>
        </div>

        <div class="section" id="step-1">
            <div class="section-title">B√∂l√ºm 1 ‚Äì ≈ûirket Bazlƒ± Genel Bilgiler</div>
            <div style="display: flex; gap: 15px; align-items: flex-end; margin-bottom: 20px; flex-wrap: wrap;">
                <div style="flex:1; min-width: 200px;">
                    <label>RFP Kapsamƒ±ndaki ≈ûirket Sayƒ±sƒ±</label>
                    <input type="number" id="companyCount" min="1" placeholder="√ñrn: 2">
                </div>
                <button class="btn-primary" onclick="createCompanies()">≈ûirketleri Olu≈ütur</button>
                <button class="btn-success" onclick="addCompany()">+ ≈ûirket Ekle</button>
            </div>
            <div id="companiesContainer"></div>
            <div style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
                <button class="btn-success" onclick="saveCompanies()">≈ûirket Bilgilerini Kaydet</button>
                <button class="btn-primary hidden" id="modTabBtn" onclick="showModTable()">≈ûirket - Mod√ºl E≈üle≈üme Tablosu</button>
            </div>
            <div id="modTableContainer" class="table-container"></div>
            <div class="nav-buttons">
                <button class="btn-secondary" onclick="showStep(0)">‚Üê Geri</button>
                <button class="btn-primary" onclick="validateAndShowStep(2)">Sonraki B√∂l√ºm ‚Üí</button>
            </div>
        </div>

        <div class="section" id="step-2">
            <div class="section-title">B√∂l√ºm 2 ‚Äì Organizasyon & Yapƒ±</div>
            <div id="orgContainer"></div>
            <div class="nav-buttons">
                <button class="btn-secondary" onclick="showStep(1)">‚Üê Geri</button>
                <button class="btn-primary" onclick="validateAndShowStep(3)">Sonraki B√∂l√ºm ‚Üí</button>
            </div>
        </div>

        <div class="section" id="step-3">
            <div class="section-title">B√∂l√ºm 3 ‚Äì ƒ∞≈ü S√ºre√ßleri</div>
            <div id="processArea"></div>
            <div class="nav-buttons">
                <button class="btn-secondary" onclick="showStep(2)">‚Üê Geri</button>
                <button class="btn-primary" onclick="validateAndShowStep(4)">Sonraki B√∂l√ºm ‚Üí</button>
            </div>
        </div>

        <div class="section" id="step-4">
            <div class="section-title">B√∂l√ºm 4 ‚Äì Teknik Entegrasyon & Yazƒ±lƒ±m Envanteri</div>
            <div id="softwareInventoryArea"></div>
            <div class="nav-buttons">
                <button class="btn-secondary" onclick="showStep(3)">‚Üê Geri</button>
                <button class="btn-primary" onclick="validateAndShowStep(5)">Sonraki B√∂l√ºm ‚Üí</button>
            </div>
        </div>

        <div class="section" id="step-5">
            <div class="section-title">B√∂l√ºm 5 ‚Äì D√∂n√º≈ü√ºm Stratejisi (Fazlandƒ±rma)</div>
            <p style="font-size: 0.9rem; color: #666; margin-bottom: 20px;">
                L√ºtfen B√∂l√ºm 1'de tanƒ±mladƒ±ƒüƒ±nƒ±z ≈üirketleri uygulama fazlarƒ±na ayƒ±rƒ±n ve hedef canlƒ±ya ge√ßi≈ü tarihlerini belirleyin.
            </p>
            <div style="margin-bottom:20px;">
                <button class="btn-success" onclick="addNewPhase()">+ Yeni Faz Ekle</button>
            </div>
            <div id="phasesContainer"></div>
            <div class="nav-buttons">
                <button class="btn-secondary" onclick="showStep(4)">‚Üê Geri</button>
                <button class="btn-primary" onclick="validateAndShowStep(6)">Son B√∂l√ºm: √áƒ±ktƒ± & √ñzet ‚Üí</button>
            </div>
        </div>

        <div class="section" id="step-6">
            <div class="section-title">B√∂l√ºm 6 ‚Äì RFP √ñzet ve √áƒ±ktƒ± Raporu</div>
            <div id="rfpReportArea"></div>
            <div class="nav-buttons">
                <button class="btn-secondary" onclick="showStep(5)">‚Üê Geri</button>
                <button class="btn-success" onclick="generateFinalReport()">Raporu G√ºncelle</button>
                <button class="btn-primary" onclick="window.print()">PDF Olarak Kaydet (Yazdƒ±r)</button>
            </div>
        </div>
    </main>

<script>
    // --- VERƒ∞ YAPILARI ---
    const sectorMap = {
        "T√ºketici End√ºstrileri": ["Tarƒ±m & Gƒ±da", "Hƒ±zlƒ± T√ºketim √úr√ºnleri (FMCG)", "ƒ∞la√ß, Medikal", "Perakende", "Toptan Daƒüƒ±tƒ±m"],
        "Kesikli √úretim": ["Otomotiv Tedarik√ßileri", "Kiralama & Leasing", "Batarya √úreticileri", "Makine ve Ekipman √úreticileri", "Y√ºksek Teknoloji √úreticileri"],
        "S√ºre√ß End√ºstrileri": ["Kimya", "Petrol & Gaz", "Enerji √úretimi", "Madencilik", "Orman √úr√ºnleri & K√¢ƒüƒ±t"],
        "Enerji ve Altyapƒ±": ["Elektrik Daƒüƒ±tƒ±m ≈ûirketleri", "Doƒüalgaz Daƒüƒ±tƒ±mƒ±", "Su ve Atƒ±k Y√∂netimi", "Yenilenebilir Enerji"],
        "Finansal Hizmetler": ["Bankalar", "Sigorta ≈ûirketleri", "Finansal Kiralama", "√ñdeme ve Finans Teknolojileri"],
        "Kamu ve Saƒülƒ±k": ["Kamu Kurumlarƒ±", "Savunma ve G√ºvenlik", "Eƒüitim ve Ara≈ütƒ±rma", "Saƒülƒ±k Hizmetleri"],
        "Hizmet End√ºstrileri": ["M√ºhendislik & ƒ∞n≈üaat", "Profesyonel Hizmetler", "Gayrimenkul", "Medya ve Eƒülence", "Spor Organizasyonlarƒ±"],
        "Ula≈üƒ±m ve ƒ∞leti≈üim": ["Havayolu ve Yolcu Ta≈üƒ±macƒ±lƒ±ƒüƒ±", "Lojistik ve Ta≈üƒ±macƒ±lƒ±k", "Telekom√ºnikasyon", "Seyahat Hizmetleri"]
    };

    const sapModules = [
        "FI - Mali Muhasebe", "FM - B√ºt√ße Kontrol", "CO - Maliyet Muhasebesi ve Karlƒ±lƒ±k", 
        "PS - Proje Sistemi", "MM - Malzeme Y√∂netimi ve Satƒ±nalma", "SD - Satƒ±≈ü ve Daƒüƒ±tƒ±m", 
        "PP - √úretim ve Planlama", "QM - Kalite Y√∂netimi", "PM - Bakƒ±m Y√∂netimi", "WM/EWM - Depo Y√∂netimi"
    ];

    const softwareGroups = {
        "Analitik & Finans": ["Power BI", "LucaNet", "Tableau", "QlikView"],
        "√úretim & Operasyon": ["Doruk OT (MES)", "SimSoft MES", "ProManage", "Siemens MES"],
        "Otomasyon": ["UiPath", "Automation Anywhere", "Blue Prism"],
        "Satƒ±≈ü & M√º≈üteri": ["T-Soft", "Salesforce", "Microsoft Dynamics CRM"],
        "ƒ∞nsan Kaynaklarƒ±": ["Kolay ƒ∞K", "Logo HR", "SAP SuccessFactors"]
    };

    const fiWbsStructure = {
        "1. Organizasyon ve Temel Muhasebe Yapƒ±sƒ±": [
            "1.1 Birden fazla ≈üirket kodu (company code) kullanƒ±yor musunuz?",
            "1.2 ≈ûirket kodlarƒ± arasƒ±nda mali konsolidasyon ihtiyacƒ± var mƒ±?",
            "1.3 Farklƒ± mali yƒ±l varyantlarƒ± kullanƒ±yor musunuz?",
            "1.4 Birden fazla hesap planƒ± (chart of accounts) ihtiyacƒ±nƒ±z var mƒ±?",
            "1.5 Yerel mevzuat ve grup raporlamasƒ± i√ßin farklƒ± muhasebe kurallarƒ± uyguluyor musunuz?"
        ],
        "2. Genel Muhasebe (General Ledger ‚Äì GL)": [
            "2.1 Ana defter muhasebesini S/4HANA Universal Journal (ACDOCA) yapƒ±sƒ± ile kullanmak ister misiniz?",
            "2.2 Birden fazla defter (leading / non-leading ledger) kullanƒ±yor musunuz?",
            "2.3 Muhasebe kayƒ±tlarƒ±nda belge bazlƒ± muhasebe prensibini uyguluyor musunuz?",
            "2.4 Otomatik muhasebe kayƒ±tlarƒ± (MM/SD kaynaklƒ±) kullanƒ±lƒ±yor mu?",
            "2.5 Manuel muhasebe fi≈üleri sƒ±k√ßa olu≈üturuluyor mu?",
            "2.6 Muhasebe fi≈üleri i√ßin onay s√ºreci bulunuyor mu?",
            "2.7 Muhasebe belgelerinde a√ßƒ±klama ve referans alanlarƒ± zorunlu mu?"
        ],
        "3. Alacaklar Muhasebesi (Accounts Receivable ‚Äì AR)": [
            "3.1 M√º≈üteri bazƒ±nda a√ßƒ±k hesap takibi yapƒ±yor musunuz?",
            "3.2 M√º≈üteri risk ve kredi limitleri tanƒ±mlƒ±yor musunuz?",
            "3.3 Vadeli satƒ±≈ü ve √∂deme planlarƒ± kullanƒ±yor musunuz?",
            "3.4 M√º≈üteri bazƒ±nda mutabakat (reconciliation) ihtiyacƒ± var mƒ±?",
            "3.5 Tahsilat s√ºre√ßlerini sistem √ºzerinden takip ediyor musunuz?",
            "3.6 Gecikmi≈ü alacaklar i√ßin otomatik hatƒ±rlatma (dunning) kullanƒ±yor musunuz?",
            "3.7 Farklƒ± para birimlerinde m√º≈üteri i≈ülemleri yapƒ±yor musunuz?"
        ],
        "4. Bor√ßlar Muhasebesi (Accounts Payable ‚Äì AP)": [
            "4.1 Tedarik√ßi bazƒ±nda a√ßƒ±k hesap takibi yapƒ±yor musunuz?",
            "4.2 Tedarik√ßi faturalarƒ± i√ßin onay s√ºreci uyguluyor musunuz?",
            "4.3 Vadeli √∂deme ve √∂deme planlarƒ± kullanƒ±yor musunuz?",
            "4.4 Avans √∂demeleri takip ediyor musunuz?",
            "4.5 Tedarik√ßi mutabakatƒ± yapƒ±yor musunuz?",
            "4.6 Otomatik √∂deme programlarƒ± kullanƒ±yor musunuz?",
            "4.7 Erken √∂deme indirimi (iskonto) uyguluyor musunuz?"
        ],
        "5. Vergi ve Yasal Raporlama": [
            "5.1 KDV hesaplamalarƒ±nƒ± sistem √ºzerinden otomatik yapmak istiyor musunuz?",
            "5.2 Farklƒ± vergi kodlarƒ± ve oranlarƒ± kullanƒ±yor musunuz?",
            "5.3 Yerel mevzuata uygun yasal defterler (yevmiye, kebir vb.) √ºretiliyor mu?",
            "5.4 Vergi beyannameleri i√ßin sistemden rapor alƒ±yor musunuz?",
            "5.5 Vergi d√ºzeltme ve fark kayƒ±tlarƒ± yapƒ±lƒ±yor mu?"
        ],
        "6. Sabit Kƒ±ymet Muhasebesi (Asset Accounting ‚Äì FI-AA)": [
            "6.1 Sabit kƒ±ymetleri sistem √ºzerinden takip ediyor musunuz?",
            "6.2 Birden fazla amortisman alanƒ± kullanƒ±yor musunuz?",
            "6.3 Vergi ve muhasebe amortismanlarƒ±nƒ± ayrƒ± ayrƒ± hesaplƒ±yor musunuz?",
            "6.4 Kƒ±ymet alƒ±m, satƒ±≈ü ve hurdaya ayƒ±rma i≈ülemleri yapƒ±lƒ±yor mu?",
            "6.5 Kƒ±ymet transferleri (departman / lokasyon) takip ediliyor mu?"
        ],
        "7. D√∂nem Sonu ve Kapanƒ±≈ü ƒ∞≈ülemleri": [
            "7.1 Aylƒ±k mali kapanƒ±≈ü s√ºre√ßleri standart bir takvime baƒülƒ± mƒ±?",
            "7.2 D√∂nem sonu reeskont ve deƒüerleme i≈ülemleri yapƒ±lƒ±yor mu?",
            "7.3 Kur farkƒ± deƒüerlemeleri sistem tarafƒ±ndan otomatik yapƒ±lƒ±yor mu?",
            "7.4 Kapanƒ±≈ü √∂ncesi kontrol ve mutabakat raporlarƒ± kullanƒ±lƒ±yor mu?",
            "7.5 D√∂nem kapatma i√ßin yetkilendirme kƒ±sƒ±tlarƒ± uygulanƒ±yor mu?"
        ],
        "8. Raporlama ve Analiz": [
            "8.1 Standart mali tablolar (Bilan√ßo, Gelir Tablosu) sistemden alƒ±nƒ±yor mu?",
            "8.2 Finansal raporlar farklƒ± kƒ±rƒ±lƒ±mlarda (≈üirket, d√∂nem, para birimi) alƒ±nmalƒ± mƒ±?",
            "8.3 Ger√ßek zamanlƒ± finansal raporlama ihtiyacƒ±nƒ±z var mƒ±?",
            "8.4 SAP Fiori finans raporlarƒ±nƒ± kullanmak ister misiniz?",
            "8.5 Kullanƒ±cƒ± bazlƒ± rapor yetkilendirmesi gerekiyor mu?"
        ],
        "9. Genel ve Kullanƒ±m": [
            "9.1 Muhasebe kullanƒ±cƒ±larƒ± i√ßin rol bazlƒ± yetkilendirme kullanƒ±yor musunuz?",
            "9.2 Muhasebe belgelerinde belge kilitleme ve deƒüi≈üiklik logu gerekli mi?",
            "9.3 √áoklu dil desteƒüi gerekli mi?",
            "9.4 √áoklu para birimi ile muhasebe tutuluyor mu?",
            "9.5 Denetim (audit) gereksinimleri i√ßin detaylƒ± izleme bekliyor musunuz?"
        ]
    };

    let companyIndex = 0;
    let savedCompanies = [];
    let modTableGenerated = false;
    let phaseCount = 0;

    function toggleSapFields() {
        const isSap = document.getElementById("existingErp").value === "SAP";
        ["sapModelArea", "sapVersionArea", "approachArea"].forEach(id => {
            document.getElementById(id).classList.toggle("hidden", !isSap);
        });
    }

    function addCompany() {
        companyIndex++;
        const container = document.getElementById("companiesContainer");
        const div = document.createElement("div");
        div.className = "company-block";
        div.innerHTML = `
            <button class="btn-danger" style="position:absolute; top:15px; right:15px; padding:5px 10px; font-size:11px;" onclick="this.parentElement.remove()">Sil</button>
            <h4 style="margin:0 0 20px 0; color:var(--primary)">≈ûirket #${companyIndex}</h4>
            <div class="grid-setup">
                <div><label>≈ûirket Adƒ±</label><input type="text" class="comp-name"></div>
                <div><label>√úlke</label><select><option>T√ºrkiye</option><option>Almanya</option><option>ABD</option></select></div>
                <div><label>Ana Sekt√∂r</label><select onchange="loadSubs(this)"><option value=""></option>${Object.keys(sectorMap).map(s=>`<option>${s}</option>`).join("")}</select></div>
                <div><label>Alt Sekt√∂r</label><select class="sub-sector"></select></div>
                <div><label>Ana Faaliyet</label><select><option>√úretim</option><option>Hizmet</option><option>Proje</option></select></div>
            </div>`;
        container.appendChild(div);
    }

    function createCompanies() {
        const count = document.getElementById("companyCount").value;
        if(!count || count < 1) { alert("L√ºtfen ge√ßerli bir ≈üirket sayƒ±sƒ± giriniz."); return; }
        document.getElementById("companiesContainer").innerHTML = "";
        companyIndex = 0;
        for(let i=0; i<count; i++) addCompany();
    }

    function loadSubs(sel) {
        const sub = sel.parentElement.nextElementSibling.querySelector("select");
        sub.innerHTML = (sectorMap[sel.value] || []).map(s=>`<option>${s}</option>`).join("");
    }

    function saveCompanies() {
        savedCompanies = Array.from(document.querySelectorAll(".comp-name")).map(i => i.value).filter(v => v);
        if(savedCompanies.length) {
            document.getElementById("modTabBtn").classList.remove("hidden");
            renderOrg();
            renderProcesses();
            renderTechInventory();
            alert("≈ûirket bilgileri kaydedildi.");
        } else {
            alert("L√ºtfen en az bir ≈üirket adƒ± giriniz.");
        }
    }

    function showModTable() {
        let html = `<table><thead><tr><th>≈ûirket Adƒ±</th>${sapModules.map(m=>`<th>${m}</th>`).join("")}</tr></thead><tbody>`;
        savedCompanies.forEach(name => {
            html += `<tr><td style="font-weight:700; text-align:left; padding-left:20px;">${name}</td>${sapModules.map(()=>`<td><input type="checkbox" style="width:18px; height:18px;"></td>`).join("")}</tr>`;
        });
        document.getElementById("modTableContainer").innerHTML = html + `</tbody></table>`;
        modTableGenerated = true;
    }

    function renderOrg() {
        let html = "";
        savedCompanies.forEach((name, i) => {
            html += `<div class="company-block">
                <h4 style="color:var(--secondary)">${name}</h4>
                ${counterRow('√úretim Tesisi', 'p'+i)}
                ${counterRow('Depo / Lojistik Merkezi', 'w'+i)}
                ${counterRow('Satƒ±≈ü Ofisi / B√∂lge M√ºd√ºrl√ºƒü√º', 's'+i)}
            </div>`;
        });
        document.getElementById("orgContainer").innerHTML = html;
    }

    function counterRow(label, id) {
        return `<div class="counter-row"><span>${label}</span><div class="counter-box">
            <button class="btn-danger" style="padding:2px 10px" onclick="chgVal('${id}',-1)">-</button>
            <span class="val-span" id="${id}">0</span>
            <button class="btn-success" style="padding:2px 10px" onclick="chgVal('${id}',1)">+</button>
        </div></div>`;
    }

    function chgVal(id, d) {
        const el = document.getElementById(id);
        el.innerText = Math.max(0, parseInt(el.innerText) + d);
    }

    function renderProcesses() {
        let html = "";
        savedCompanies.forEach((name, companyIdx) => {
            html += `<div class="company-block" style="border-left: 8px solid var(--primary);">
                <h3 style="color:var(--secondary); margin-bottom:20px; background:#e3f2fd; padding:10px; border-radius:5px;">
                    ${name} - Mali Muhasebe (FI) S√ºre√ß Analizi
                </h3>`;
            for (const [sectionTitle, questions] of Object.entries(fiWbsStructure)) {
                html += `<div style="margin-bottom: 30px;"><h4 style="background: var(--secondary); color: white; padding: 10px 15px; border-radius: 5px; font-size: 1rem;">${sectionTitle}</h4>
                <div class="table-container" style="margin-top:0;"><table style="min-width: 100%;"><thead><tr><th style="width: 40%; text-align: left;">S√ºre√ß Sorusu</th><th style="width: 25%;">Cevap</th><th style="width: 35%;">A√ßƒ±klama / Not</th></tr></thead><tbody>`;
                questions.forEach((q, qIdx) => {
                    html += `<tr><td style="text-align: left; font-size: 0.85rem; font-weight: 600;">${q}</td><td><select style="padding: 5px;"><option value="">Se√ßiniz</option><option>Evet</option><option>Hayƒ±r</option><option>Kƒ±smen</option></select></td><td><input type="text" placeholder="Not..." style="padding: 5px; width: 95%;"></td></tr>`;
                });
                html += `</tbody></table></div></div>`;
            }
            html += `</div>`;
        });
        document.getElementById("processArea").innerHTML = html;
    }

    function renderTechInventory() {
        let html = "";
        Object.keys(softwareGroups).forEach((groupName, gIdx) => {
            html += `
            <div class="company-block">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h4 style="margin:0; color:var(--secondary);">${groupName}</h4>
                    <div style="display:flex; gap:10px;">
                        <select id="select-soft-${gIdx}" style="width:200px; padding:8px;">
                            <option value="">Yazƒ±lƒ±m Se√ß...</option>
                            ${softwareGroups[groupName].map(s => `<option value="${s}">${s}</option>`).join("")}
                            <option value="Dƒ∞ƒûER">Diƒüer +</option>
                        </select>
                        <button class="btn-success" style="padding:8px 15px;" onclick="addSoftwareRow(${gIdx})">+</button>
                    </div>
                </div>
                <div class="table-container" id="container-soft-${gIdx}" style="display:none; margin-top:0;">
                    <table style="min-width:100%;"><thead><tr><th style="text-align:left; width:30%;">Yazƒ±lƒ±m</th><th style="text-align:left; width:50%;">Hedef Mimari Konumu</th><th style="width:20%;">ƒ∞≈ülem</th></tr></thead><tbody id="tbody-soft-${gIdx}"></tbody></table>
                </div>
            </div>`;
        });
        document.getElementById("softwareInventoryArea").innerHTML = html;
    }

    function addSoftwareRow(gIdx) {
        const select = document.getElementById(`select-soft-${gIdx}`);
        let val = select.value;
        if(!val) return;
        if(val === "Dƒ∞ƒûER") { val = prompt("Yazƒ±lƒ±m adƒ±:"); if(!val) return; }
        const container = document.getElementById(`container-soft-${gIdx}`);
        const tbody = document.getElementById(`tbody-soft-${gIdx}`);
        container.style.display = "block";
        const tr = document.createElement("tr");
        tr.innerHTML = `<td style="text-align:left; font-weight:600;">${val}</td><td style="text-align:left;"><select style="padding:8px;"><option>SAP √ºr√ºn ve mod√ºl√º ile deƒüi≈ütirilebilir</option><option>Hedef Mimaride kalacak</option><option>3. parti sistem ile deƒüi≈ütirilebilir</option></select></td><td><button class="btn-danger" style="padding:5px 12px;" onclick="removeSoftwareRow(this, ${gIdx})">- Kaldƒ±r</button></td>`;
        tbody.appendChild(tr);
    }

    function removeSoftwareRow(btn, gIdx) {
        btn.closest("tr").remove();
        const tbody = document.getElementById(`tbody-soft-${gIdx}`);
        if(tbody.children.length === 0) document.getElementById(`container-soft-${gIdx}`).style.display = "none";
    }

    // --- B√ñL√úM 5: FAZLANDIRMA ---
    function addNewPhase() {
        phaseCount++;
        const container = document.getElementById("phasesContainer");
        const div = document.createElement("div");
        div.className = "phase-card";
        div.innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h4 style="margin:0; color:var(--primary)">Faz #${phaseCount} Planlamasƒ±</h4>
                <button class="btn-danger" style="padding:5px 10px; font-size:0.7rem;" onclick="this.closest('.phase-card').remove()">Fazƒ± Kaldƒ±r</button>
            </div>
            <div class="grid-setup" style="grid-template-columns: 1fr 1fr;">
                <div>
                    <label>Hedef Canlƒ±ya Ge√ßi≈ü Tarihi</label>
                    <input type="month" class="phase-date">
                </div>
                <div>
                    <label>Bu Faza ≈ûirket Ekle</label>
                    <div style="display:flex; gap:5px;">
                        <select class="phase-comp-select">
                            <option value="">≈ûirket Se√ßin...</option>
                            ${savedCompanies.map(c => `<option value="${c}">${c}</option>`).join("")}
                        </select>
                        <button class="btn-success" style="padding:5px 15px;" onclick="addCompToPhase(this)">+</button>
                    </div>
                </div>
            </div>
            <div class="selected-companies-list" style="margin-top:10px;">
                <label>Bu Fazdaki ≈ûirketler:</label>
                <div class="badges-area"></div>
            </div>
        `;
        container.appendChild(div);
    }

    function addCompToPhase(btn) {
        const select = btn.previousElementSibling;
        const companyName = select.value;
        if(!companyName) return;
        const badgesArea = btn.closest(".phase-card").querySelector(".badges-area");
        const existing = Array.from(badgesArea.querySelectorAll(".phase-badge")).map(b => b.dataset.name);
        if(existing.includes(companyName)) { alert("Bu ≈üirket zaten bu faza ekli."); return; }
        const span = document.createElement("span");
        span.className = "phase-badge";
        span.dataset.name = companyName;
        span.innerHTML = `${companyName} <span style="cursor:pointer; margin-left:8px; font-weight:bold" onclick="this.parentElement.remove()">√ó</span>`;
        badgesArea.appendChild(span);
    }

    // --- B√ñL√úM 6: RAPOR OLU≈ûTURMA ---
    function generateFinalReport() {
        const erp = document.getElementById("existingErp").value;
        const approach = document.getElementById("sapApproach").value || "Belirtilmedi";
        let phaseHtml = "";
        document.querySelectorAll(".phase-card").forEach((card, i) => {
            const date = card.querySelector(".phase-date").value || "Tarih Belirtilmedi";
            const companies = Array.from(card.querySelectorAll(".phase-badge")).map(b => b.dataset.name).join(", ");
            phaseHtml += `<div style="border-left:4px solid var(--accent); padding-left:15px; margin-bottom:15px;">
                <strong>Faz ${i+1} (${date}):</strong> ${companies || '≈ûirket atanmadƒ±'}
            </div>`;
        });

        document.getElementById("rfpReportArea").innerHTML = `
            <div class="company-block" style="background:#fff; border: 2px solid var(--primary);">
                <h2 style="color:var(--primary); text-align:center; border-bottom:2px solid var(--primary); padding-bottom:10px;">S/4HANA D√ñN√ú≈û√úM PROJESƒ∞ RFP √ñZETƒ∞</h2>
                <h4 style="color:var(--secondary)">1. Proje Yakla≈üƒ±mƒ±</h4>
                <p>Mevcut Sistem: <strong>${erp}</strong> | Ge√ßi≈ü Stratejisi: <strong>${approach}</strong></p>
                <h4 style="color:var(--secondary)">2. Kapsamdaki ≈ûirketler</h4>
                <ul>${savedCompanies.map(c => `<li>${c}</li>`).join("")}</ul>
                <h4 style="color:var(--secondary)">3. Uygulama Takvimi</h4>
                ${phaseHtml}
                <div style="margin-top:20px; padding:15px; background:#fff3e0; border-radius:8px;">
                    <strong>üí° IEZU Tech Notu:</strong> Rapor detaylarƒ± ve teknik envanter eklerde mevcuttur.
                </div>
            </div>`;
    }

    function validateAndShowStep(targetIdx) {
        const currentIdx = parseInt(document.querySelector("nav ul li.active").id.split("-")[1]);
        if (targetIdx < currentIdx) { showStep(targetIdx); return; }
        if (currentIdx === 0 && !document.getElementById("existingErp").value) { alert("ERP se√ßiniz."); return; }
        if (currentIdx === 1 && savedCompanies.length === 0) { alert("≈ûirketleri kaydedin."); return; }
        if (targetIdx === 6) generateFinalReport();
        showStep(targetIdx);
    }

    function showStep(idx) {
        document.querySelectorAll(".section").forEach((s, i) => s.classList.toggle("active", i === idx));
        document.querySelectorAll("nav ul li").forEach((l, i) => l.classList.toggle("active", i === idx));
        document.getElementById("progress-bar").style.width = (idx / 6 * 100) + "%";
        window.scrollTo(0,0);
    }
</script>
</body>
</html>
