<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S4Scope – SAP S/4HANA RFP Manager | IEZU Tech</title>
    <style>
        :root {
            --primary: #0d47a1;
            --secondary: #1a237e;
            --accent: #00c853;
            --bg: #f0f2f5;
            --card: #ffffff;
            --text: #2c3e50;
            --border: #dee2e6;
        }

        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; display: flex; }

        /* PROGRESS BAR */
        #progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 5px; background: #ddd; z-index: 2000; }
        #progress-bar { height: 100%; width: 0%; background: var(--accent); transition: 0.4s; }

        /* NAVIGATOR */
        nav { width: 280px; background: var(--secondary); color: white; height: 100vh; position: fixed; padding-top: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.2); }
        nav h2 { padding: 0 20px; font-size: 1.2rem; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; }
        nav ul { list-style: none; padding: 0; }
        nav ul li { padding: 15px 25px; cursor: pointer; transition: 0.3s; opacity: 0.7; font-size: 0.9rem; }
        nav ul li.active { opacity: 1; background: rgba(255,255,255,0.1); border-left: 5px solid var(--accent); font-weight: bold; }

        /* MAIN */
        main { flex: 1; margin-left: 280px; padding: 40px; }
        .section { background: var(--card); padding: 35px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: none; }
        .section.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .section-title { border-left: 5px solid var(--primary); padding-left: 15px; margin-bottom: 25px; font-size: 1.3rem; color: var(--secondary); font-weight: 700; }
        
        .company-grid { display: grid; grid-template-columns: 1.5fr 1fr 1.5fr 1.5fr 1.2fr; gap: 15px; align-items: start; }
        label { font-weight: 600; font-size: 0.85rem; color: #546e7a; display: block; margin-bottom: 8px; }
        input, select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; box-sizing: border-box; }
        
        /* Çoklu seçim için yükseklik */
        select[multiple] { height: 80px; padding: 5px; background: #fff; }

        .company-block { background: #f8fbff; border: 1px solid #e3e9ef; border-radius: 10px; padding: 25px; margin-top: 20px; position: relative; }
        
        .counter-row { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
        .counter-box { display: flex; align-items: center; gap: 10px; background: white; padding: 5px 10px; border-radius: 20px; border: 1px solid #ddd; }
        .val-span { font-weight: 700; color: var(--primary); min-width: 20px; text-align: center; }

        button { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.3s; display: inline-flex; align-items: center; gap: 8px;}
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--accent); color: white; }
        .btn-danger { background: #d32f2f; color: white; }
        .btn-secondary { background: #78909c; color: white; }
        .btn-sm { padding: 5px 10px; font-size: 11px; }

        .table-container { overflow-x: auto; margin-top: 10px; border-radius: 8px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; min-width: 1100px; }
        th { background: var(--secondary); color: white; padding: 15px; font-size: 0.75rem; text-transform: uppercase; }
        td { padding: 12px; border: 1px solid #eee; text-align: center; background: white; font-size: 0.9rem;}

        .hidden { display: none; }
        .nav-buttons { margin-top: 30px; display: flex; justify-content: space-between; border-top: 1px solid #eee; padding-top: 20px; }

        /* AKORDİYON */
        .process-category { margin-bottom: 10px; border: 1px solid #e0e0e0; border-radius: 8px; overflow: hidden; }
        .process-header { background: #f8f9fa; padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: 0.3s; font-weight: 700; color: var(--secondary); }
        .process-header:hover { background: #eceff1; }
        .process-header::after { content: '▼'; font-size: 0.8rem; transition: 0.3s; }
        .process-category.open .process-header::after { transform: rotate(180deg); }
        .process-content { display: none; padding: 15px; background: white; border-top: 1px solid #eee; }
        .process-category.open .process-content { display: block; }

        .checkbox-group { background: #fdfdfd; border: 1px solid #eee; padding: 10px; border-radius: 8px; max-height: 150px; overflow-y: auto; margin-top: 5px; }
        .checkbox-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; margin-bottom: 8px; cursor: pointer; }

        @media print {
            nav, #progress-container, .nav-buttons, button { display: none !important; }
            main { margin-left: 0; padding: 0; }
            .section { box-shadow: none; border: none; display: block !important; }
            .process-content { display: block !important; }
        }
    </style>
</head>
<body>

    <div id="progress-container"><div id="progress-bar"></div></div>

    <nav>
        <h2>S4Scope RFP</h2>
        <ul>
            <li onclick="validateAndShowStep(0)" id="nav-0" class="active">Bölüm 0: ERP Yapısı</li>
            <li onclick="validateAndShowStep(1)" id="nav-1">Bölüm 1: Genel Bilgiler</li>
            <li onclick="validateAndShowStep(2)" id="nav-2">Bölüm 2: Organizasyon & Yapı</li>
            <li onclick="validateAndShowStep(3)" id="nav-3">Bölüm 3: İş Süreçleri</li>
            <li onclick="validateAndShowStep(4)" id="nav-4">Bölüm 4: Teknik & Entegrasyon</li>
            <li onclick="validateAndShowStep(5)" id="nav-5">Bölüm 5: Dönüşüm Stratejisi</li>
            <li onclick="validateAndShowStep(6)" id="nav-6">Bölüm 6: Çıktı & Özet</li>
        </ul>
        <div style="position: absolute; bottom: 20px; left: 20px;">
            <button class="btn-danger" style="padding: 8px 15px; font-size: 12px;" onclick="window.location.href='index.html'">Çıkış Yap</button>
        </div>
    </nav>

    <main>
        <div class="section active" id="step-0">
            <div class="section-title">Bölüm 0 - ERP Yapısı</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div>
                    <label>Mevcut ERP Sistemi</label>
                    <select id="existingErp" onchange="toggleSapFields()">
                        <option value="">Seçiniz</option>
                        <option value="SAP">SAP</option>
                        <option value="Oracle">Oracle</option>
                        <option value="Logo">Logo</option>
                        <option value="Diğer">Diğer</option>
                    </select>
                </div>
                <div id="sapModelArea" class="hidden">
                    <label>SAP Modeli</label>
                    <select id="sapModel">
                        <option value="">Seçiniz</option>
                        <option>S/4HANA OnPremise</option>
                        <option>S/4HANA Public Cloud</option>
                        <option>S/4HANA Private Cloud</option>
                        <option>ECC</option>
                        <option>R/3</option>
                    </select>
                </div>
                <div id="sapVersionArea" class="hidden">
                    <label>SAP Versiyonu</label>
                    <input type="text" id="sapVersion" placeholder="Örn: 1909, 2022 FPS02">
                </div>
                <div id="approachArea" class="hidden">
                    <label>Geçiş Yaklaşımı</label>
                    <select id="sapApproach">
                        <option value="">Seçiniz</option>
                        <option>Greenfield</option>
                        <option>Brownfield</option>
                        <option>Bluefield / Hibrit</option>
                        <option>Henüz karar verilmedi</option>
                    </select>
                </div>
            </div>
            <div class="nav-buttons" style="justify-content: flex-end;">
                <button class="btn-primary" onclick="validateAndShowStep(1)">Sonraki Bölüm →</button>
            </div>
        </div>

        <div class="section" id="step-1">
            <div class="section-title">Bölüm 1 – Şirket Bazlı Genel Bilgiler</div>
            <div style="display: flex; gap: 15px; align-items: flex-end; margin-bottom: 20px; flex-wrap: wrap;">
                <div style="flex:1; min-width: 200px;">
                    <label>RFP Kapsamındaki Şirket Sayısı</label>
                    <input type="number" id="companyCount" min="1" placeholder="Örn: 2">
                </div>
                <button class="btn-primary" onclick="createCompanies()">Şirketleri Oluştur</button>
                <button class="btn-success" onclick="addCompany()">+ Şirket Ekle</button>
            </div>
            <div id="companiesContainer"></div>
            <div style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
                <button class="btn-success" onclick="saveCompanies()">Şirket Bilgilerini Kaydet</button>
                <button class="btn-primary hidden" id="modTabBtn" onclick="showModTable()">Şirket - Modül Eşleşme Tablosu</button>
            </div>
            <div id="modTableContainer" class="table-container"></div>
            <div class="nav-buttons">
                <button class="btn-secondary" onclick="showStep(0)">← Geri</button>
                <button class="btn-primary" onclick="validateAndShowStep(2)">Sonraki Bölüm →</button>
            </div>
        </div>

        <div class="section" id="step-2">
            <div class="section-title">Bölüm 2 – Organizasyon & Yapı</div>
            <div id="orgContainer"></div>
            <div class="nav-buttons">
                <button class="btn-secondary" onclick="showStep(1)">← Geri</button>
                <button class="btn-primary" onclick="validateAndShowStep(3)">Sonraki Bölüm →</button>
            </div>
        </div>

        <div class="section" id="step-3">
            <div class="section-title">Bölüm 3 – İş Süreçleri Analizi (FI)</div>
            <p style="font-size: 0.8rem; color: #666; margin-bottom: 10px;">* Birden fazla şirket seçmek için <strong>Ctrl (veya Cmd)</strong> tuşuna basılı tutun.</p>
            <div id="processArea"></div>
            <div class="nav-buttons">
                <button class="btn-secondary" onclick="showStep(2)">← Geri</button>
                <button class="btn-primary" onclick="validateAndShowStep(4)">Sonraki Bölüm →</button>
            </div>
        </div>

        <div class="section" id="step-4">
            <div class="section-title">Bölüm 4 – Teknik Entegrasyon & Yazılım Envanteri</div>
            <div id="softwareInventoryArea"></div>
            <div class="nav-buttons">
                <button class="btn-secondary" onclick="showStep(3)">← Geri</button>
                <button class="btn-primary" onclick="validateAndShowStep(5)">Sonraki Bölüm →</button>
            </div>
        </div>

        <div class="section" id="step-5">
            <div class="section-title">Bölüm 5 – Dönüşüm Stratejisi (Fazlandırma)</div>
            <div style="margin-bottom:20px;"><button class="btn-success" onclick="addNewPhase()">+ Yeni Faz Ekle</button></div>
            <div id="phasesContainer"></div>
            <div class="nav-buttons">
                <button class="btn-secondary" onclick="showStep(4)">← Geri</button>
                <button class="btn-primary" onclick="validateAndShowStep(6)">Son Bölüm: Çıktı & Özet →</button>
            </div>
        </div>

        <div class="section" id="step-6">
            <div class="section-title">Bölüm 6 – RFP Özet ve Çıktı Raporu</div>
            <div id="rfpReportArea"></div>
            <div class="nav-buttons">
                <button class="btn-secondary" onclick="showStep(5)">← Geri</button>
                <button class="btn-success" onclick="generateFinalReport()">Raporu Güncelle</button>
                <button class="btn-primary" onclick="window.print()">PDF Olarak Kaydet</button>
            </div>
        </div>
    </main>

<script>
    // --- VERİ YAPILARI (HİÇBİRİ KIRPILMADI) ---
    const sectorMap = {
        "Tüketici Endüstrileri": ["Tarım & Gıda", "FMCG", "İlaç", "Perakende", "Toptan Dağıtım"],
        "Kesikli Üretim": ["Otomotiv", "Kiralama", "Batarya", "Makine", "Yüksek Teknoloji"],
        "Süreç Endüstrileri": ["Kimya", "Petrol & Gaz", "Madencilik", "Kağıt"],
        "Enerji ve Altyapı": ["Elektrik Dağıtım", "Doğalgaz", "Su/Atık", "Yenilenebilir Enerji"],
        "Finansal Hizmetler": ["Bankalar", "Sigorta", "Leasing", "Fintech"],
        "Kamu ve Sağlık": ["Kamu Kurumları", "Savunma", "Eğitim", "Sağlık"],
        "Hizmet Endüstrileri": ["İnşaat", "Profesyonel Hizmetler", "Gayrimenkul", "Medya"],
        "Ulaşım ve İletişim": ["Havayolu", "Lojistik", "Telekomünikasyon", "Seyahat"]
    };

    const sapModules = ["FI", "FM", "CO", "PS", "MM", "SD", "PP", "QM", "PM", "WM/EWM"];

    const softwareGroups = {
        "Analitik & Finans": ["Power BI", "LucaNet", "Tableau", "QlikView"],
        "Üretim & Operasyon": ["Doruk OT (MES)", "SimSoft MES", "ProManage", "Siemens MES"],
        "Otomasyon": ["UiPath", "Automation Anywhere", "Blue Prism"],
        "Satış & Müşteri": ["T-Soft", "Salesforce", "Microsoft Dynamics CRM"],
        "İnsan Kaynakları": ["Kolay İK", "Logo HR", "SAP SuccessFactors"]
    };

    const fiWbsStructure = {
        "1. Organizasyon ve Temel Muhasebe Yapısı": [
            "1.1 Birden fazla şirket kodu (company code) kullanıyor musunuz?",
            "1.2 Şirket kodları arasında mali konsolidasyon ihtiyacı var mı?",
            "1.3 Farklı mali yıl varyantları kullanıyor musunuz?",
            "1.4 Birden fazla hesap planı (chart of accounts) ihtiyacınız var mı?",
            "1.5 Yerel mevzuat ve grup raporlaması için farklı muhasebe kuralları uyguluyor musunuz?"
        ],
        "2. Genel Muhasebe (General Ledger – GL)": [
            "2.1 Ana defter muhasebesini ACDOCA yapısı ile kullanmak ister misiniz?",
            "2.2 Birden fazla defter (leading / non-leading ledger) kullanıyor musunuz?",
            "2.3 Muhasebe kayıtlarında belge bazlı muhasebe prensibini uyguluyor musunuz?",
            "2.4 Otomatik muhasebe kayıtları (MM/SD kaynaklı) kullanılıyor mu?",
            "2.5 Manuel muhasebe fişleri sıkça oluşturuluyor mu?",
            "2.6 Muhasebe fişleri için onay süreci bulunuyor mu?",
            "2.7 Muhasebe belgelerinde açıklama ve referans alanları zorunlu mu?"
        ],
        "3. Alacaklar Muhasebesi (Accounts Receivable – AR)": [
            "3.1 Müşteri bazında açık hesap takibi yapıyor musunuz?",
            "3.2 Müşteri risk ve kredi limitleri tanımlıyor musunuz?",
            "3.3 Vadeli satış ve ödeme planları kullanıyor musunuz?",
            "3.4 Müşteri bazında mutabakat ihtiyacı var mı?",
            "3.5 Tahsilat süreçlerini sistem üzerinden takip ediyor musunuz?",
            "3.6 Gecikmiş alacaklar için otomatik hatırlatma (dunning) kullanıyor musunuz?",
            "3.7 Farklı para birimlerinde müşteri işlemleri yapıyor musunuz?"
        ],
        "4. Borçlar Muhasebesi (Accounts Payable – AP)": [
            "4.1 Tedarikçi bazında açık hesap takibi yapıyor musunuz?",
            "4.2 Tedarikçi faturaları için onay süreci uyguluyor musunuz?",
            "4.3 Vadeli ödeme ve ödeme planları kullanıyor musunuz?",
            "4.4 Avans ödemeleri takip ediyor musunuz?",
            "4.5 Tedarikçi mutabakatı yapıyor musunuz?",
            "4.6 Otomatik ödeme programları kullanıyor musunuz?",
            "4.7 Erken ödeme indirimi (iskonto) uyguluyor musunuz?"
        ],
        "5. Vergi ve Yasal Raporlama": [
            "5.1 KDV hesaplamalarını sistem üzerinden otomatik yapmak istiyor musunuz?",
            "5.2 Farklı vergi kodları ve oranları kullanıyor musunuz?",
            "5.3 Yerel mevzuata uygun yasal defterler üretiliyor mu?",
            "5.4 Vergi beyannameleri için sistemden rapor alıyor musunuz?",
            "5.5 Vergi düzeltme ve fark kayıtları yapılıyor mu?"
        ],
        "6. Sabit Kıymet Muhasebesi (Asset Accounting – FI-AA)": [
            "6.1 Sabit kıymetleri sistem üzerinden takip ediyor musunuz?",
            "6.2 Birden fazla amortisman alanı kullanıyor musunuz?",
            "6.3 Vergi ve muhasebe amortismanlarını ayrı ayrı hesaplıyor musunuz?",
            "6.4 Kıymet alım, satış ve hurdaya ayırma işlemleri yapılıyor mu?",
            "6.5 Kıymet transferleri takip ediliyor mu?"
        ],
        "7. Dönem Sonu ve Kapanış İşlemleri": [
            "7.1 Aylık mali kapanış süreçleri standart bir takvime bağlı mı?",
            "7.2 Dönem sonu reeskont ve değerleme işlemleri yapılıyor mu?",
            "7.3 Kur farkı değerlemeleri sistem tarafından otomatik yapılıyor mu?",
            "7.4 Kapanış öncesi kontrol ve mutabakat raporları kullanılıyor mu?",
            "7.5 Dönem kapatma için yetkilendirme kısıtları uygulanıyor mu?"
        ],
        "8. Raporlama ve Analiz": [
            "8.1 Standart mali tablolar (Bilanço, Gelir Tablosu) sistemden alınıyor mu?",
            "8.2 Finansal raporlar farklı kırılımlarda alınmalı mı?",
            "8.3 Gerçek zamanlı finansal raporlama ihtiyacınız var mı?",
            "8.4 SAP Fiori finans raporlarını kullanmak ister misiniz?",
            "8.5 Kullanıcı bazlı rapor yetkilendirmesi gerekiyor mu?"
        ],
        "9. Genel ve Kullanım": [
            "9.1 Muhasebe kullanıcıları için rol bazlı yetkilendirme kullanıyor musunuz?",
            "9.2 Muhasebe belgelerinde belge kilitleme ve değişiklik logu gerekli mi?",
            "9.3 Çoklu dil desteği gerekli mi?",
            "9.4 Çoklu para birimi ile muhasebe tutuluyor mu?",
            "9.5 Denetim gereksinimleri için detaylı izleme bekliyor musunuz?"
        ]
    };

    let companyIndex = 0;
    let savedCompanies = [];
    let phaseCount = 0;

    function toggleSapFields() {
        const isSap = document.getElementById("existingErp").value === "SAP";
        ["sapModelArea", "sapVersionArea", "approachArea"].forEach(id => {
            document.getElementById(id).classList.toggle("hidden", !isSap);
        });
    }

    function addCompany() {
        companyIndex++;
        const div = document.createElement("div");
        div.className = "company-block";
        div.innerHTML = `
            <button class="btn-danger" style="position:absolute; top:15px; right:15px; padding:5px 10px; font-size:11px;" onclick="this.parentElement.remove()">Sil</button>
            <h4 style="margin:0 0 20px 0; color:var(--primary)">Şirket #${companyIndex}</h4>
            <div class="company-grid">
                <div><label>Şirket Adı</label><input type="text" class="comp-name"></div>
                <div><label>Ülke</label><select><option>Türkiye</option><option>Almanya</option><option>ABD</option><option>Diğer</option></select></div>
                <div><label>Ana Sektör</label><select onchange="loadSubs(this)"><option value=""></option>${Object.keys(sectorMap).map(s=>`<option>${s}</option>`).join("")}</select></div>
                <div><label>Alt Sektör</label><select class="sub-sector"></select></div>
                <div><label>Ana Faaliyet</label><select><option>Üretim</option><option>Hizmet</option><option>Proje</option></select></div>
            </div>`;
        document.getElementById("companiesContainer").appendChild(div);
    }

    function createCompanies() {
        const count = document.getElementById("companyCount").value;
        if(!count || count < 1) return;
        document.getElementById("companiesContainer").innerHTML = "";
        companyIndex = 0;
        for(let i=0; i<count; i++) addCompany();
    }

    function loadSubs(sel) {
        const sub = sel.parentElement.nextElementSibling.querySelector("select");
        sub.innerHTML = (sectorMap[sel.value] || []).map(s=>`<option>${s}</option>`).join("") || '<option value="">Önce Ana Sektör Seçin</option>';
    }

    function saveCompanies() {
        savedCompanies = Array.from(document.querySelectorAll(".comp-name")).map(i => i.value).filter(v => v);
        if(savedCompanies.length) {
            document.getElementById("modTabBtn").classList.remove("hidden");
            renderOrg(); renderProcesses(); renderTechInventory();
            alert("Şirket bilgileri kaydedildi.");
        }
    }

    function showModTable() {
        let html = `<table><thead><tr><th>Şirket Adı</th>${sapModules.map(m=>`<th>${m}</th>`).join("")}</tr></thead><tbody>`;
        savedCompanies.forEach(name => {
            html += `<tr><td style="font-weight:700; text-align:left; padding-left:20px;">${name}</td>${sapModules.map(()=>`<td><input type="checkbox" style="width:18px; height:18px;"></td>`).join("")}</tr>`;
        });
        document.getElementById("modTableContainer").innerHTML = html + `</tbody></table>`;
    }

    function renderOrg() {
        let html = "";
        savedCompanies.forEach((name, i) => {
            html += `<div class="company-block"><h4>${name}</h4>
                ${counterRow('Üretim Tesisi', 'p'+i)}
                ${counterRow('Depo / Lojistik Merkezi', 'w'+i)}
                ${counterRow('Satış Ofisi / Bölge Müdürlüğü', 's'+i)}
            </div>`;
        });
        document.getElementById("orgContainer").innerHTML = html;
    }

    function counterRow(label, id) {
        return `<div class="counter-row"><span>${label}</span><div class="counter-box">
            <button class="btn-danger btn-sm" onclick="chgVal('${id}',-1)">-</button>
            <span class="val-span" id="${id}">0</span>
            <button class="btn-success btn-sm" onclick="chgVal('${id}',1)">+</button>
        </div></div>`;
    }

    function chgVal(id, d) {
        const el = document.getElementById(id);
        el.innerText = Math.max(0, parseInt(el.innerText) + d);
    }

    // --- BÖLÜM 3: GELİŞMİŞ SÜREÇ ANALİZİ ---
    function renderProcesses() {
        let html = `<div class="company-block" style="border-left: 8px solid var(--primary);"><h3>FI Süreç Analizi</h3>`;
        let catIndex = 0;
        for (const [title, qs] of Object.entries(fiWbsStructure)) {
            catIndex++;
            html += `
            <div class="process-category">
                <div class="process-header" onclick="this.parentElement.classList.toggle('open')">${title}</div>
                <div class="process-content">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th style="text-align:left; width:35%;">Süreç Sorusu</th>
                                    <th style="width:15%;">Cevap</th>
                                    <th style="width:15%;">Şirket Kapsamı</th>
                                    <th>Not</th>
                                    <th style="width:100px;">İşlem</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-cat-${catIndex}">`;
            qs.forEach(q => html += generateProcessRow(q, false, false));
            html += `</tbody></table></div>
                    <div style="margin-top:15px;">
                        <button class="btn-success btn-sm" onclick="addNewProcessRow('${catIndex}')">+ Yeni Özel Süreç Ekle</button>
                    </div>
                </div>
            </div>`;
        }
        document.getElementById("processArea").innerHTML = html + "</div>";
    }

    function generateProcessRow(questionText, isNew = false, isDeletable = false) {
        const companyOptions = `<option value="ALL" selected>Tüm Şirketler</option>` + 
                               savedCompanies.map(c => `<option value="${c}">${c}</option>`).join("");
        
        return `
            <tr>
                <td style="text-align:left;">
                    ${isNew ? `<input type="text" placeholder="Süreci yazın..." style="width:95%;">` : `<span style="font-weight:600;">${questionText}</span>`}
                </td>
                <td>
                    <select>
                        <option value="">Seçiniz</option>
                        <option>Evet</option>
                        <option>Hayır</option>
                        <option>Kısmen</option>
                    </select>
                </td>
                <td>
                    <select multiple title="Ctrl tuşuyla çoklu seçim yapın">${companyOptions}</select>
                </td>
                <td><input type="text" placeholder="Not..." style="width:95%;"></td>
                <td>
                    <div style="display:flex; gap:5px; justify-content:center;">
                        ${!isNew ? `<button class="btn-primary btn-sm" title="Soruyu Çoğalt" onclick="duplicateRow(this)">⧉</button>` : ''}
                        ${isDeletable ? `<button class="btn-danger btn-sm" title="Sil" onclick="this.closest('tr').remove()">✕</button>` : `<button class="btn-secondary btn-sm" disabled style="opacity:0.3; cursor:not-allowed;" title="Ana soru silinemez">✕</button>`}
                    </div>
                </td>
            </tr>`;
    }

    function duplicateRow(btn) {
        const currentRow = btn.closest('tr');
        const qText = currentRow.cells[0].innerText;
        const newRowHTML = generateProcessRow(qText, false, true);
        currentRow.insertAdjacentHTML('afterend', newRowHTML);
    }

    function addNewProcessRow(catId) {
        const tbody = document.getElementById(`tbody-cat-${catId}`);
        const newRowHTML = generateProcessRow("", true, true);
        tbody.insertAdjacentHTML('beforeend', newRowHTML);
    }

    // --- BÖLÜM 4: TEKNİK ENVANTER (HİÇBİRİ KIRPILMADI) ---
    function renderTechInventory() {
        let html = "";
        Object.keys(softwareGroups).forEach((group, i) => {
            html += `<div class="company-block">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h4 style="margin:0;">${group}</h4>
                    <div style="display:flex; gap:10px;">
                        <select id="sel-soft-${i}" style="width:200px;">
                            <option value="">Yazılım Seç...</option>
                            ${softwareGroups[group].map(s=>`<option value="${s}">${s}</option>`).join("")}
                            <option value="DİĞER">Diğer +</option>
                        </select>
                        <button class="btn-success" onclick="addSoftwareRow(${i})">+</button>
                    </div>
                </div>
                <div class="table-container" id="cont-soft-${i}" style="display:none; margin-top:15px;">
                    <table style="min-width:100%;"><thead><tr><th>Yazılım</th><th style="width:50%">Hedef Mimari Konumu</th><th>İşlem</th></tr></thead><tbody id="tbody-soft-${i}"></tbody></table>
                </div>
            </div>`;
        });
        document.getElementById("softwareInventoryArea").innerHTML = html;
    }

    function addSoftwareRow(i) {
        let val = document.getElementById(`sel-soft-${i}`).value;
        if(!val) return;
        if(val === "DİĞER") { val = prompt("Yazılım Adı:"); if(!val) return; }
        document.getElementById(`cont-soft-${i}`).style.display = "block";
        const tr = document.createElement("tr");
        tr.innerHTML = `<td style="font-weight:600;">${val}</td><td><select><option>Değiştirilebilir</option><option>Kalacak</option></select></td><td><button class="btn-danger btn-sm" onclick="this.closest('tr').remove()">✕</button></td>`;
        document.getElementById(`tbody-soft-${i}`).appendChild(tr);
    }

    function addNewPhase() {
        phaseCount++;
        const div = document.createElement("div");
        div.className = "company-block phase-card";
        div.innerHTML = `
            <div style="display:flex; justify-content:space-between; margin-bottom:15px;"><h4 style="margin:0;">Faz #${phaseCount}</h4><button class="btn-danger btn-sm" onclick="this.remove()">✕</button></div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                <div><label>Tarih</label><input type="month"></div>
                <div><label>Şirketler</label><div class="checkbox-group">${savedCompanies.map(c => `<label class="checkbox-item"><input type="checkbox"> ${c}</label>`).join("")}</div></div>
            </div>`;
        document.getElementById("phasesContainer").appendChild(div);
    }

    function generateFinalReport() {
        document.getElementById("rfpReportArea").innerHTML = `<div class="company-block" style="background:#fff; border: 2px solid var(--primary); text-align:center;"><h2>RFP ÖZETİ HAZIRLANDI</h2><p>Raporu PDF almak için yazdır butonunu kullanın.</p></div>`;
    }

    function validateAndShowStep(idx) { if(idx === 6) generateFinalReport(); showStep(idx); }
    function showStep(idx) {
        document.querySelectorAll(".section").forEach((s, i) => s.classList.toggle("active", i === idx));
        document.querySelectorAll("nav ul li").forEach((l, i) => l.classList.toggle("active", i === idx));
        document.getElementById("progress-bar").style.width = (idx / 6 * 100) + "%";
        window.scrollTo(0,0);
    }
</script>
</body>
</html>
