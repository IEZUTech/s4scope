<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S4Scope ‚Äì SAP S/4HANA RFP Manager | IEZU Tech</title>
    <style>
        :root {
            --primary: #0d47a1;
            --secondary: #1a237e;
            --accent: #00c853;
            --bg: #f0f2f5;
            --card: #ffffff;
            --text: #2c3e50;
            --border: #dee2e6;
        }

        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; display: flex; color: var(--text); }

        #progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 5px; background: #ddd; z-index: 2000; }
        #progress-bar { height: 100%; width: 0%; background: var(--accent); transition: 0.4s; }

        nav { width: 280px; background: var(--secondary); color: white; height: 100vh; position: fixed; top: 0; left: 0; padding-top: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.2); z-index: 1000; overflow-y: auto; }
        nav h2 { padding: 0 20px; font-size: 1.2rem; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; }
        nav ul { list-style: none; padding: 0; margin: 0; }
        nav ul li { padding: 15px 25px; cursor: pointer; transition: 0.3s; opacity: 0.7; font-size: 0.9rem; border-bottom: 1px solid rgba(255,255,255,0.05); }
        nav ul li:hover { background: rgba(255,255,255,0.05); opacity: 1; }
        nav ul li.active { opacity: 1; background: rgba(255,255,255,0.15); border-left: 5px solid var(--accent); font-weight: bold; }

        main { flex: 1; margin-left: 280px; padding: 40px; width: calc(100% - 280px); }
        .section { background: var(--card); padding: 35px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: none; margin-bottom: 40px; }
        .section.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .section-title { border-left: 5px solid var(--primary); padding-left: 15px; margin-bottom: 25px; font-size: 1.3rem; color: var(--secondary); font-weight: 700; }
        
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; box-sizing: border-box; transition: 0.3s; }
        input:focus, select:focus { border-color: var(--primary); outline: none; }
        
        .company-block { background: #f8fbff; border: 1px solid #e3e9ef; border-radius: 10px; padding: 25px; margin-top: 20px; position: relative; }
        
        /* B√ñL√úM 5 YENƒ∞ G√ñRSEL TASARIM */
        .phase-card { border: 1px solid #e0e6ed; background: #ffffff; border-left: 6px solid var(--primary); padding: 25px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        .phase-header-row { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f0f0f0; padding-bottom: 15px; margin-bottom: 15px; }
        .phase-badge { background: var(--primary); color: white; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 700; text-transform: uppercase; }
        .checkbox-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; background: #fcfdfe; padding: 15px; border-radius: 6px; border: 1px dashed #ced4da; }
        .checkbox-item { display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer; }

        button { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.3s; display: inline-flex; align-items: center; gap: 8px;}
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--accent); color: white; }
        .btn-danger { background: #d32f2f; color: white; }
        .btn-secondary { background: #78909c; color: white; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }

        .table-container { overflow-x: auto; margin-top: 10px; border-radius: 8px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; min-width: 1100px; }
        th { background: var(--secondary); color: white; padding: 15px; font-size: 0.75rem; text-transform: uppercase; text-align: center; }
        td { padding: 12px; border: 1px solid #eee; text-align: center; background: white; font-size: 0.85rem; }

        .excel-dropdown { border: 1px solid #ced4da; padding: 8px 12px; border-radius: 6px; background: #fdfdfd; cursor: pointer; display: flex; justify-content: space-between; align-items: center; position: relative; font-size: 13px; min-width: 180px; }
        .excel-menu { position: absolute; top: 100%; left: 0; width: 240px; background: white; border: 1px solid #bbb; box-shadow: 0 10px 25px rgba(0,0,0,0.15); z-index: 5000; display: none; max-height: 250px; overflow-y: auto; border-radius: 8px; margin-top: 5px; }
        .excel-menu label { display: flex; align-items: center; padding: 10px 15px; border-bottom: 1px solid #f1f1f1; cursor: pointer; gap: 10px; text-align: left; }

        .process-category { margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 8px; overflow: hidden; }
        .process-header { background: #f8f9fa; padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 700; color: var(--secondary); }
        .process-content { display: none; padding: 20px; background: white; }
        .process-category.open .process-content { display: block; }

        .counter-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee; }
        .counter-box { display: flex; align-items: center; gap: 10px; background: white; padding: 5px 15px; border-radius: 20px; border: 1px solid #ddd; }
        .val-span { font-weight: 700; color: var(--primary); min-width: 25px; text-align: center; }

        .hidden { display: none !important; }
        .nav-buttons { margin-top: 30px; display: flex; justify-content: space-between; border-top: 1px solid #eee; padding-top: 20px; }

        @media print {
            nav, #progress-container, .nav-buttons, button { display: none !important; }
            main { margin-left: 0; padding: 0; width: 100%; }
            .section { display: block !important; box-shadow: none; page-break-after: always; }
            .process-content { display: block !important; }
        }
    </style>
</head>
<body onclick="closeAllMenus()">

    <div id="progress-container"><div id="progress-bar"></div></div>

    <nav>
        <h2>S4Scope RFP</h2>
        <ul>
            <li onclick="validateAndShowStep(0)" id="nav-0" class="active">B√∂l√ºm 0: ERP Yapƒ±sƒ±</li>
            <li onclick="validateAndShowStep(1)" id="nav-1">B√∂l√ºm 1: Genel Bilgiler</li>
            <li onclick="validateAndShowStep(2)" id="nav-2">B√∂l√ºm 2: Organizasyon & Yapƒ±</li>
            <li onclick="validateAndShowStep(3)" id="nav-3">B√∂l√ºm 3: ƒ∞≈ü S√ºre√ßleri</li>
            <li onclick="validateAndShowStep(4)" id="nav-4">B√∂l√ºm 4: Teknik & Entegrasyon</li>
            <li onclick="validateAndShowStep(5)" id="nav-5">B√∂l√ºm 5: D√∂n√º≈ü√ºm Stratejisi</li>
            <li onclick="validateAndShowStep(6)" id="nav-6">B√∂l√ºm 6: √áƒ±ktƒ± & √ñzet</li>
        </ul>
    </nav>

    <main>
        <div class="section active" id="step-0">
            <div class="section-title">B√∂l√ºm 0 - Mevcut ve Hedef ERP Yapƒ±sƒ±</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <div><label>Mevcut ERP Sistemi</label>
                    <select id="existingErp" onchange="toggleSapFields()">
                        <option value="">Se√ßiniz</option><option value="SAP">SAP</option><option value="Oracle">Oracle</option><option value="Logo">Logo</option><option value="Microsoft Dynamics">Microsoft Dynamics</option><option value="Diƒüer">Diƒüer</option>
                    </select>
                </div>
                <div id="sapModelArea" class="hidden"><label>Hedef SAP Modeli</label>
                    <select id="sapModel">
                        <option value="">Se√ßiniz</option><option>S/4HANA OnPremise</option><option>S/4HANA Public Cloud</option><option>S/4HANA Private Cloud</option><option>ECC (Legacy)</option>
                    </select>
                </div>
                <div id="sapVersionArea" class="hidden"><label>Mevcut SAP Versiyonu</label><input type="text" id="sapVersion" placeholder="√ñrn: ECC 6.0 EHP7"></div>
                <div id="approachArea" class="hidden"><label>Ge√ßi≈ü Yakla≈üƒ±mƒ±</label>
                    <select id="sapApproach">
                        <option value="">Se√ßiniz</option><option>Greenfield (Sƒ±fƒ±rdan Kurulum)</option><option>Brownfield (D√∂n√º≈ü√ºm)</option><option>Bluefield / Hibrit</option><option>Karar verilmedi</option>
                    </select>
                </div>
            </div>
            <div class="nav-buttons" style="justify-content: flex-end;"><button class="btn-primary" onclick="validateAndShowStep(1)">Sonraki B√∂l√ºm ‚Üí</button></div>
        </div>

        <div class="section" id="step-1">
            <div class="section-title">B√∂l√ºm 1 ‚Äì ≈ûirket Bazlƒ± Genel Bilgiler</div>
            <div style="display: flex; gap: 15px; align-items: flex-end; margin-bottom: 20px;">
                <div style="flex:1;"><label>≈ûirket Sayƒ±sƒ±</label><input type="number" id="companyCount" min="1" placeholder="√ñrn: 2"></div>
                <button class="btn-primary" onclick="createCompanies()">≈ûirketleri Olu≈ütur</button>
            </div>
            <div id="companiesContainer"></div>
            <div style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
                <button class="btn-success" onclick="saveCompanies()">≈ûirketleri Kaydet</button>
                <button class="btn-primary hidden" id="modTabBtn" onclick="showModTable()">≈ûirket-Mod√ºl Matrisi</button>
            </div>
            <div id="modTableContainer" class="table-container"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(0)">‚Üê Geri</button><button class="btn-primary" onclick="validateAndShowStep(2)">Sonraki B√∂l√ºm ‚Üí</button></div>
        </div>

        <div class="section" id="step-2">
            <div class="section-title">B√∂l√ºm 2 ‚Äì Organizasyon & Yapƒ±</div>
            <div id="orgContainer"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(1)">‚Üê Geri</button><button class="btn-primary" onclick="validateAndShowStep(3)">Sonraki B√∂l√ºm ‚Üí</button></div>
        </div>

        <div class="section" id="step-3">
            <div class="section-title">B√∂l√ºm 3 ‚Äì ƒ∞≈ü S√ºre√ßleri Analizi</div>
            <div id="processArea"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(2)">‚Üê Geri</button><button class="btn-primary" onclick="validateAndShowStep(4)">Sonraki B√∂l√ºm ‚Üí</button></div>
        </div>

        <div class="section" id="step-4">
            <div class="section-title">B√∂l√ºm 4 ‚Äì Teknik Entegrasyon & Yazƒ±lƒ±m Envanteri</div>
            <div id="softwareInventoryArea"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(3)">‚Üê Geri</button><button class="btn-primary" onclick="validateAndShowStep(5)">Sonraki B√∂l√ºm ‚Üí</button></div>
        </div>

        <div class="section" id="step-5">
            <div class="section-title">B√∂l√ºm 5 ‚Äì D√∂n√º≈ü√ºm Stratejisi (Fazlandƒ±rma)</div>
            <button class="btn-success" style="margin-bottom:20px;" onclick="addNewPhase()">+ Yeni Faz Ekle</button>
            <div id="phasesContainer"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(4)">‚Üê Geri</button><button class="btn-primary" onclick="validateAndShowStep(6)">Raporu G√∂r√ºnt√ºle ‚Üí</button></div>
        </div>

        <div class="section" id="step-6">
            <div class="section-title">B√∂l√ºm 6 ‚Äì RFP √ñzet ve √áƒ±ktƒ± Raporu</div>
            <div id="rfpReportArea"></div>
            <div class="nav-buttons"><button class="btn-secondary" onclick="showStep(5)">‚Üê Geri</button><button class="btn-success" onclick="generateFinalReport()">Raporu G√ºncelle</button><button class="btn-primary" onclick="window.print()">PDF Kaydet</button></div>
        </div>
    </main>

<script>
    // --- VERƒ∞ SETLERƒ∞ (TAM Lƒ∞STE - Hƒ∞√áBƒ∞R ≈ûEY KISILMADI) ---
    const sectorMap = { "T√ºketici End√ºstrileri": ["Tarƒ±m & Gƒ±da", "FMCG", "ƒ∞la√ß", "Perakende"], "Kesikli √úretim": ["Otomotiv", "Makine √úretimi", "Y√ºksek Teknoloji", "Savunma Sanayi"], "S√ºre√ß End√ºstrileri": ["Kimya", "Petrol & Gaz", "Madencilik", "Metal"], "Enerji ve Altyapƒ±": ["Elektrik Daƒüƒ±tƒ±m", "Su/Atƒ±k", "Telekom√ºnikasyon"], "Finansal Hizmetler": ["Banka", "Sigorta", "Fintech"], "Hizmet End√ºstrileri": ["ƒ∞n≈üaat", "Lojistik", "Turizm", "Profesyonel Hizmetler"] };
    const sapModules = [ "FI - Mali Muhasebe", "FM - B√ºt√ße Kontrol", "CO - Maliyet Muhasebesi ve Karlƒ±lƒ±k", "PS - Proje Sistemi", "MM - Malzeme Y√∂netimi ve Satƒ±nalma", "SD - Satƒ±≈ü ve Daƒüƒ±tƒ±m", "PP - √úretim ve Planlama", "QM - Kalite Y√∂netimi", "PM - Bakƒ±m Y√∂netimi", "WM/EWM - Depo Y√∂netimi" ];
    const softwareGroups = { "Analitik & Finans": ["Power BI", "LucaNet", "Tableau", "Cognos"], "√úretim & Operasyon": ["Doruk OT", "ProManage", "MES Sistemleri", "SCADA"], "Satƒ±≈ü & M√º≈üteri": ["T-Soft", "Salesforce", "Magento", "Hybris"], "ƒ∞nsan Kaynaklarƒ±": ["Kolay ƒ∞K", "Logo HR", "SuccessFactors", "Workday"] };
    
    // TAM FI SORU SETƒ∞
    const fiWbsStructure = { 
        "1. Organizasyon ve Temel Muhasebe Yapƒ±sƒ±": ["1.1 Birden fazla ≈üirket kodu kullanƒ±mƒ± var mƒ±?", "1.2 Mali konsolidasyon ihtiyacƒ± (Yasal/Y√∂netimsel) var mƒ±?", "1.3 Farklƒ± mali yƒ±l varyantlarƒ± (√ñrn: Ocak-Aralƒ±k vs Nisan-Mart) kullanƒ±lƒ±yor mu?", "1.4 Birden fazla hesap planƒ± (Yerel/Grup) ihtiyacƒ± var mƒ±?", "1.5 Yerel mevzuat ve Grup raporlama standartlarƒ± (IFRS/TFRS) farkƒ± y√∂netiliyor mu?"], 
        "2. Genel Muhasebe (GL)": ["2.1 S/4HANA Universal Journal yapƒ±sƒ±na ge√ßi≈üte √∂zel bir defter (Ledger) ihtiyacƒ± var mƒ±?", "2.2 Birden fazla defter (Parallel Ledger) kullanƒ±mƒ± gerekiyor mu?", "2.3 Belge bazlƒ± (Document Splitting) muhasebe takibi var mƒ±?", "2.4 Otomatik MM/SD entegrasyon kayƒ±tlarƒ± yoƒüunluƒüu nedir?", "2.5 Manuel fi≈ü giri≈üi operasyonel bir y√ºk olu≈üturuyor mu?", "2.6 Fi≈ü onay s√ºreci (Workflow) ihtiyacƒ± var mƒ±?", "2.7 Zorunlu alan kontrolleri (Field Status) karma≈üƒ±k mƒ±?"], 
        "3. Alacaklar (AR)": ["3.1 M√º≈üteri a√ßƒ±k hesap takibi ve ya≈ülandƒ±rma yapƒ±lƒ±yor mu?", "3.2 Kredi ve risk limit y√∂netimi ihtiyacƒ± var mƒ±?", "3.3 Karma≈üƒ±k √∂deme planlarƒ± uygulanƒ±yor mu?", "3.4 M√º≈üteri mutabakat s√ºre√ßleri sistem √ºzerinden mi y√∂netiliyor?", "3.5 Tahsilat takibi (Collection Management) s√ºreci var mƒ±?", "3.6 Otomatik ihtar (Dunning) s√ºre√ßleri kullanƒ±lƒ±yor mu?", "3.7 √áoklu para birimi ile takip yoƒüun mu?"], 
        "4. Bor√ßlar (AP)": ["4.1 Tedarik√ßi a√ßƒ±k hesap takibi yapƒ±lƒ±yor mu?", "4.2 Fatura onay s√ºre√ßleri (VIM veya Standart) ihtiyacƒ± var mƒ±?", "4.3 Vadeli √∂deme ve nakit akƒ±≈ü planlamasƒ± yapƒ±lƒ±yor mu?", "4.4 Avans takibi ve mahsup i≈ülemleri karma≈üƒ±k mƒ±?", "4.5 Tedarik√ßi mutabakatlarƒ± nasƒ±l y√∂netiliyor?", "4.6 Otomatik √∂deme (F110) s√ºreci kullanƒ±lƒ±yor mu?", "4.7 ƒ∞skonto ve vade farkƒ± uygulamalarƒ± var mƒ±?"], 
        "5. Vergi ve Yasal Raporlama": ["5.1 Otomatik KDV hesaplama ve beyanname altyapƒ±sƒ± var mƒ±?", "5.2 Tevkifatlƒ± fatura s√ºre√ßleri yoƒüun mu?", "5.3 Yasal defter (E-Defter) √ºretimi sistemden mi yapƒ±lƒ±yor?", "5.4 Diƒüer yasal beyanname (BA/BS, KDV1, KDV2 vb.) raporlarƒ± alƒ±nƒ±yor mu?", "5.5 Vergi d√ºzeltme ve kar≈üƒ±lƒ±k kayƒ±tlarƒ± yapƒ±lƒ±yor mu?"], 
        "6. Sabit Kƒ±ymetler (FI-AA)": ["6.1 Sabit kƒ±ymetler sistem √ºzerinden mi takip ediliyor?", "6.2 √áoklu amortisman alanƒ± (Yasal/Grup/Vergi) ihtiyacƒ± var mƒ±?", "6.3 Vergi mevzuatƒ± ve muhasebe standartlarƒ± amortisman farkƒ± y√∂netiliyor mu?", "6.4 Kƒ±ymet alƒ±m, satƒ±≈ü, hurdaya ayƒ±rma i≈ülemleri yoƒüun mu?", "6.5 Kƒ±ymet transferleri ve yatƒ±rƒ±m takibi yapƒ±lƒ±yor mu?"], 
        "7. Kapanƒ±≈ü ƒ∞≈ülemleri": ["7.1 D√∂nem sonu kapanƒ±≈ü takvimi ve kontrol listesi kullanƒ±lƒ±yor mu?", "7.2 Reeskont ve deƒüerleme i≈ülemleri otomatik mi?", "7.3 Yabancƒ± para birimi deƒüerlemesi yapƒ±lƒ±yor mu?", "7.4 Kapanƒ±≈ü √∂ncesi entegrasyon kontrolleri (MM/SD/FI) yapƒ±lƒ±yor mu?", "7.5 Yetkilendirme bazlƒ± d√∂nem kapatma uygulanƒ±yor mu?"], 
        "8. Raporlama ve Analiz": ["8.1 Standart mali tablolar (Bilan√ßo/Gelir Tablosu) sistemden alƒ±nƒ±yor mu?", "8.2 Masraf yeri, kar merkezi bazlƒ± kƒ±rƒ±lƒ±mlar takip ediliyor mu?", "8.3 Ger√ßek zamanlƒ± y√∂netim raporlamasƒ± ihtiyacƒ± var mƒ±?", "8.4 Fiori tabanlƒ± analitik uygulamalar kullanƒ±lƒ±yor mu?", "8.5 Raporlarƒ±n yetkilendirme kƒ±sƒ±tlamalarƒ± var mƒ±?"], 
        "9. Genel ve Kullanƒ±m": ["9.1 Rol bazlƒ± yetkilendirme yapƒ±sƒ± kurulu mu?", "9.2 Kritik alanlarƒ±n deƒüi≈üiklik loglarƒ± (Change Logs) takip ediliyor mu?", "9.3 √áoklu dil desteƒüi ihtiyacƒ± var mƒ±?", "9.4 √áoklu para birimi (Yerel/Sistem/Grup) kullanƒ±mƒ± var mƒ±?", "9.5 ƒ∞√ß/Dƒ±≈ü denetim izleme (Audit Trail) gereksinimleri var mƒ±?"] 
    };

    const otherModules = { 
        "CO - Maliyet Muhasebesi": ["Masraf Yeri ve Kar Merkezi Muhasebesi?", "√úr√ºn Maliyetlendirme (Product Costing)?", "Karlƒ±lƒ±k Analizi (CO-PA)?", "Sipari≈ü bazlƒ± maliyet takibi?", "Transfer fiyatlandƒ±rmasƒ±?"], 
        "FM - B√ºt√ße Kontrol": ["B√ºt√ße kontrol√º (AVC) aktif mi?", "Taahh√ºt y√∂netimi (Commitment) var mƒ±?", "Nakit b√ºt√ßesi takibi?"], 
        "MM - Satƒ±nalma": ["Mobil onay s√ºre√ßleri?", "√áer√ßeve s√∂zle≈üme takibi?", "Tedarik√ßi deƒüerlendirme?", "MRP Live kullanƒ±mƒ±?", "Fason √ºretim y√∂netimi?"], 
        "SD - Satƒ±≈ü": ["Karma≈üƒ±k fiyatlandƒ±rma (Pricing)?", "Kredi limit y√∂netimi?", "Bedelsiz s√ºre√ßleri?", "Settlement Management?", "Lojistik faturalama?"], 
        "PP - √úretim": ["MTS, MTO veya ETO √ºretimi?", "Kapasite planlama?", "MES entegrasyonu?", "√úretim teyit y√∂ntemleri?"], 
        "QM - Kalite": ["Giri≈ü kalite kontrol?", "S√ºre√ß i√ßi kontrol?", "Laboratuvar y√∂netimi?", "8D raporlama?"], 
        "PM - Bakƒ±m": ["Ekipman hiyerar≈üisi?", "Planlƒ±/Arƒ±za bazlƒ± bakƒ±m?", "Dƒ±≈ü hizmet alƒ±mƒ±?", "Mobil i≈ü emri?"], 
        "WM/EWM - Depo": ["Adresli depo takibi?", "RF/El terminali kullanƒ±mƒ±?", "Paketleme ve Sevkiyat?", "Sayƒ±m s√ºre√ßleri?"] 
    };
    const allProcessStructures = { ...fiWbsStructure, ...otherModules };

    let companyIndex = 0; let savedCompanies = []; let phaseCount = 0; let rowCounter = 0;

    // --- FONKSƒ∞YONLAR ---
    function toggleSapFields() { 
        const isSap = document.getElementById("existingErp").value === "SAP"; 
        ["sapModelArea", "sapVersionArea", "approachArea"].forEach(id => document.getElementById(id).classList.toggle("hidden", !isSap)); 
    }
    
    function addCompany() {
        companyIndex++;
        const div = document.createElement("div");
        div.className = "company-block";
        div.innerHTML = `
            <button class="btn-danger btn-sm" style="position:absolute; top:15px; right:15px;" onclick="this.parentElement.remove()">Sil</button>
            <h4 style="margin:0 0 15px 0; color:var(--primary)">≈ûirket #${companyIndex}</h4>
            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:15px;">
                <div><label>≈ûirket Adƒ±</label><input type="text" class="comp-name"></div>
                <div><label>√úlke</label><select><option>T√ºrkiye</option><option>Diƒüer</option></select></div>
                <div><label>Ana Sekt√∂r</label><select onchange="loadSubs(this)"><option value="">Se√ßiniz</option>${Object.keys(sectorMap).map(s=>`<option>${s}</option>`).join("")}</select></div>
                <div><label>Alt Sekt√∂r</label><select class="sub-sector"><option>-</option></select></div>
            </div>`;
        document.getElementById("companiesContainer").appendChild(div);
    }
    
    function createCompanies() {
        const count = document.getElementById("companyCount").value;
        document.getElementById("companiesContainer").innerHTML = "";
        companyIndex = 0;
        for(let i=0; i<count; i++) addCompany();
    }

    function loadSubs(sel) { 
        const sub = sel.parentElement.nextElementSibling.querySelector("select"); 
        sub.innerHTML = (sectorMap[sel.value] || []).map(s=>`<option>${s}</option>`).join(""); 
    }

    function saveCompanies() {
        savedCompanies = Array.from(document.querySelectorAll(".comp-name")).map(i => i.value).filter(v => v);
        if(savedCompanies.length) {
            document.getElementById("modTabBtn").classList.remove("hidden");
            renderOrg();
            renderProcesses();
            renderTechInventory();
            alert("Kaydedildi.");
        }
    }

    function showModTable() {
        let html = `<table><thead><tr><th>≈ûirket</th>${sapModules.map(m=>`<th>${m}</th>`).join("")}</tr></thead><tbody>`;
        savedCompanies.forEach(name => {
            html += `<tr><td><b>${name}</b></td>${sapModules.map(()=>`<td><input type="checkbox"></td>`).join("")}</tr>`;
        });
        document.getElementById("modTableContainer").innerHTML = html + `</tbody></table>`;
    }

    function renderOrg() {
        let html = "";
        savedCompanies.forEach((name, i) => {
            html += `<div class="company-block"><h4>${name} - Lokasyon Detaylarƒ±</h4>
                ${counterRow('√úretim Tesisi', 'p'+i)} ${counterRow('Depo', 'w'+i)}
            </div>`;
        });
        document.getElementById("orgContainer").innerHTML = html;
    }

    function counterRow(label, id) {
        return `<div class="counter-row"><span>${label}</span><div class="counter-box"><button class="btn-danger btn-sm" onclick="chgVal('${id}',-1)">-</button><span class="val-span" id="${id}">0</span><button class="btn-success btn-sm" onclick="chgVal('${id}',1)">+</button></div></div>`;
    }

    function chgVal(id, d) { const el = document.getElementById(id); el.innerText = Math.max(0, parseInt(el.innerText) + d); }

    function renderProcesses() {
        let html = ""; let catIndex = 0;
        for (const [title, qs] of Object.entries(allProcessStructures)) {
            catIndex++;
            html += `<div class="process-category"><div class="process-header" onclick="this.parentElement.classList.toggle('open')">${title}</div><div class="process-content"><div class="table-container"><table><thead><tr><th>Soru</th><th>Cevap</th><th>√ñncelik</th><th>Kapsam</th><th>Not</th><th>ƒ∞≈ülem</th></tr></thead><tbody id="tbody-cat-${catIndex}">`;
            qs.forEach(q => html += generateProcessRow(q, false, false));
            html += `</tbody></table></div><button class="btn-success btn-sm" onclick="addNewProcessRow('${catIndex}')">+ Ekle</button></div></div>`;
        }
        document.getElementById("processArea").innerHTML = html;
    }

    function generateProcessRow(q, isNew, isDeletable) {
        rowCounter++; const dropId = "drop-" + rowCounter;
        return `<tr><td style="text-align:left;">${isNew ? `<input type="text">` : `<b>${q}</b>`}</td><td><select><option>-</option><option>Evet</option><option>Hayƒ±r</option></select></td><td><select><option>Normal</option><option>Kritik</option></select></td><td><div class="excel-dropdown" onclick="toggleExcelMenu(event, '${dropId}')"><span id="label-${dropId}">T√ºm ≈ûirketler</span> ‚ñº<div id="${dropId}" class="excel-menu" onclick="event.stopPropagation()">${savedCompanies.map(c => `<label><input type="checkbox" checked onchange="updateExcelLabel('${dropId}')"> ${c}</label>`).join('')}</div></div></td><td><input type="text"></td><td>${isDeletable ? `<button class="btn-danger btn-sm" onclick="this.closest('tr').remove()">‚úï</button>` : ''}</td></tr>`;
    }

    function addNewProcessRow(id) { document.getElementById(`tbody-cat-${id}`).insertAdjacentHTML('beforeend', generateProcessRow("", true, true)); }
    function toggleExcelMenu(e, id) { e.stopPropagation(); closeAllMenus(); document.getElementById(id).style.display = 'block'; }
    function closeAllMenus() { document.querySelectorAll('.excel-menu').forEach(m => m.style.display = 'none'); }
    function updateExcelLabel(id) {
        const menu = document.getElementById(id); const count = menu.querySelectorAll('input:checked').length;
        document.getElementById('label-' + id).innerText = count === savedCompanies.length ? "T√ºm ≈ûirketler" : count + " Se√ßili";
    }

    // B√ñL√úM 4: TAM KARAR SE√áENEKLERƒ∞YLE
    function renderTechInventory() {
        let html = "";
        Object.keys(softwareGroups).forEach((group, i) => {
            html += `<div class="company-block"><div style="display:flex; justify-content:space-between"><h4>${group}</h4><div><select id="sel-soft-${i}"><option value="">Se√ß...</option>${softwareGroups[group].map(s=>`<option>${s}</option>`).join("")}<option>Dƒ∞ƒûER</option></select><button class="btn-success btn-sm" onclick="addSoftwareRow(${i})">Ekle</button></div></div><div class="table-container" id="cont-soft-${i}" style="display:none; margin-top:10px;"><table><thead><tr><th>Yazƒ±lƒ±m</th><th style="width:400px;">Hedef Mimari Kararƒ±</th><th>‚úï</th></tr></thead><tbody id="tbody-soft-${i}"></tbody></table></div></div>`;
        });
        document.getElementById("softwareInventoryArea").innerHTML = html;
    }

    function addSoftwareRow(i) {
        let val = document.getElementById(`sel-soft-${i}`).value; if(!val) return;
        if(val === "Dƒ∞ƒûER") { val = prompt("Yazƒ±lƒ±m Adƒ±:"); if(!val) return; }
        document.getElementById(`cont-soft-${i}`).style.display = "block";
        const tr = document.createElement("tr");
        tr.innerHTML = `<td><b>${val}</b></td><td><select>
            <option>SAP √úr√ºn/Mod√ºl/Addon ile deƒüi≈ütirilebilir</option>
            <option>Hedef Mimaride kullanƒ±ma devam edilecek (Entegrasyon)</option>
            <option>3. Parti Farklƒ± Bir Yazƒ±lƒ±m ile deƒüi≈ütirilebilir</option>
            <option>Kullanƒ±mdan kaldƒ±rƒ±lacak (Emekli edilecek)</option>
        </select></td><td><button class="btn-danger btn-sm" onclick="this.closest('tr').remove()">‚úï</button></td>`;
        document.getElementById(`tbody-soft-${i}`).appendChild(tr);
    }

    // B√ñL√úM 5: YENƒ∞ TASARIM
    function addNewPhase() {
        phaseCount++;
        const div = document.createElement("div"); div.className = "phase-card";
        div.innerHTML = `
            <div class="phase-header-row"><span class="phase-badge">FAZ ${phaseCount}</span><input type="text" placeholder="Faz Adƒ±" style="width:300px; font-weight:bold;"><button class="btn-danger btn-sm" onclick="this.closest('.phase-card').remove()">Sil</button></div>
            <div style="display:grid; grid-template-columns: 1fr 2fr; gap:30px;">
                <div><label style="font-weight:600;">üìÖ Canlƒ± Ge√ßi≈ü Tarihi</label><input type="month"></div>
                <div><label style="font-weight:600;">üè¢ ≈ûirket Kapsamƒ±</label>
                    <div class="checkbox-grid">${savedCompanies.map(c => `<label class="checkbox-item"><input type="checkbox" checked> ${c}</label>`).join("")}</div>
                </div>
            </div>`;
        document.getElementById("phasesContainer").appendChild(div);
    }

    function generateFinalReport() { document.getElementById("rfpReportArea").innerHTML = `<h2>RFP Raporu</h2><p>Kapsam: ${savedCompanies.join(", ")}</p>`; }
    function validateAndShowStep(idx) { if(idx === 6) generateFinalReport(); showStep(idx); }
    function showStep(idx) { 
        document.querySelectorAll(".section").forEach((s, i) => s.classList.toggle("active", i === idx)); 
        document.querySelectorAll("nav ul li").forEach((l, i) => l.classList.toggle("active", i === idx)); 
        document.getElementById("progress-bar").style.width = ((idx + 1) / 7 * 100) + "%"; 
    }
</script>
</body>
</html>
